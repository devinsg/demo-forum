"use strict";define("admin/manage/category",["uploader","iconSelect","categorySelector","benchpress","api"],function(a,t,e,i,n){var r={};var o={};r.init=function(){$("#category-settings select").each(function(){var a=$(this);a.val(a.attr("data-value"))});e.init($('[component="category-selector"]'),function(a){ajaxify.go("admin/manage/categories/"+a.cid)});s();$("#category-settings input, #category-settings select").on("change",function(a){c(a.target)});$('[data-name="imageClass"]').on("change",function(){$(".category-preview").css("background-size",$(this).val())});$('[data-name="bgColor"], [data-name="color"]').on("input",function(){var a=$(this);var t=a.parents("[data-cid]").find(".category-preview");if(a.attr("data-name")==="bgColor"){t.css("background-color",a.val())}else if(a.attr("data-name")==="color"){t.css("color",a.val())}c(a[0])});$("#save").on("click",function(){var a=$("#tag-whitelist").val()?$("#tag-whitelist").val().split(","):[];if(a.length&&a.length<parseInt($("#cid-min-tags").val(),10)){return app.alertError("[[admin/manage/categories:alert.not-enough-whitelisted-tags]]")}var t=ajaxify.data.category.cid;n.put("/categories/"+t,o).then(a=>{app.flags._unsaved=false;app.alert({title:"Updated Categories",message:'Category "'+a.name+'" was successfully updated.',type:"success",timeout:5e3});o={}});return false});$(".purge").on("click",function(a){a.preventDefault();i.parse("admin/partials/categories/purge",{name:ajaxify.data.category.name,topic_count:ajaxify.data.category.topic_count},function(a){var t=bootbox.dialog({title:"[[admin/manage/categories:purge]]",message:a,size:"large",buttons:{save:{label:"[[modules:bootbox.confirm]]",className:"btn-primary",callback:function(){t.find(".modal-footer button").prop("disabled",true);var a=setInterval(function(){socket.emit("categories.getTopicCount",ajaxify.data.category.cid,function(a,e){if(a){return app.alertError(a)}var i=0;if(ajaxify.data.category.topic_count>0){i=Math.max(0,1-e/ajaxify.data.category.topic_count)*100}t.find(".progress-bar").css({width:i+"%"})})},1e3);n.del("/categories/"+ajaxify.data.category.cid).then(()=>{if(a){clearInterval(a)}t.modal("hide");app.alertSuccess("[[admin/manage/categories:alert.purge-success]]");ajaxify.go("admin/manage/categories")});return false}}}})})});$(".copy-settings").on("click",function(){socket.emit("categories.getSelectCategories",{},function(a,t){if(a){return app.alertError(a.message)}i.parse("admin/partials/categories/copy-settings",{categories:t},function(a){var t;var i=bootbox.dialog({title:"[[modules:composer.select_category]]",message:a,buttons:{save:{label:"[[modules:bootbox.confirm]]",className:"btn-primary",callback:function(){if(!t||parseInt(t,10)===parseInt(ajaxify.data.category.cid,10)){return}socket.emit("admin.categories.copySettingsFrom",{fromCid:t,toCid:ajaxify.data.category.cid,copyParent:i.find("#copyParent").prop("checked")},function(a){if(a){return app.alertError(a.message)}i.modal("hide");app.alertSuccess("[[admin/manage/categories:alert.copy-success]]");ajaxify.refresh()});return false}}}});i.find(".modal-footer button").prop("disabled",true);e.init(i.find('[component="category-selector"]'),function(a){t=a&&a.cid;if(t){i.find(".modal-footer button").prop("disabled",false)}})});return false})});$(".upload-button").on("click",function(){var t=$(this);var e=t.attr("data-cid");a.show({title:"[[admin/manage/categories:alert.upload-image]]",route:config.relative_path+"/api/admin/category/uploadpicture",params:{cid:e}},function(a){$("#category-image").val(a);var e=t.parent().parent().siblings(".category-preview");e.css("background","url("+a+"?"+(new Date).getTime()+")");c($("#category-image"))})});$("#category-image").on("change",function(){$(".category-preview").css("background-image",$(this).val()?'url("'+$(this).val()+'")':"");c($("#category-image"))});$(".delete-image").on("click",function(a){a.preventDefault();var t=$("#category-image");var e=$(".category-preview");t.val("");e.css("background-image","");c(t[0]);$(this).parent().addClass("hide").hide()});$(".category-preview").on("click",function(){t.init($(this).find("i"),c)});$('[type="checkbox"]').on("change",function(){c($(this))});$('button[data-action="setParent"], button[data-action="changeParent"]').on("click",r.launchParentSelector);$('button[data-action="removeParent"]').on("click",function(){n.put("/categories/"+ajaxify.data.category.cid,{parentCid:0}).then(()=>{$('button[data-action="removeParent"]').parent().addClass("hide");$('button[data-action="changeParent"]').parent().addClass("hide");$('button[data-action="setParent"]').removeClass("hide")})});$('button[data-action="toggle"]').on("click",function(){var a=$(this);var t=a.attr("data-disabled")==="1";n.put("/categories/"+ajaxify.data.category.cid,{disabled:t?0:1}).then(()=>{a.translateText(!t?"[[admin/manage/categories:enable]]":"[[admin/manage/categories:disable]]");a.toggleClass("btn-primary",!t).toggleClass("btn-danger",t);a.attr("data-disabled",t?0:1)})})};function c(a){var t;if($(a).is(":checkbox")){t=$(a).is(":checked")?1:0}else{t=$(a).val()}o[$(a).attr("data-name")]=t;app.flags=app.flags||{};app.flags._unsaved=true}function s(){var a=$("#tag-whitelist");a.tagsinput({confirmKeys:[13,44],trimValue:true});ajaxify.data.category.tagWhitelist.forEach(function(t){a.tagsinput("add",t)});a.on("itemAdded itemRemoved",function(){c(a)})}r.launchParentSelector=function(){socket.emit("categories.getSelectCategories",{},function(a,t){if(a){return app.alertError(a.message)}var i=[parseInt(ajaxify.data.category.cid,10)];var r=t.filter(function(a){var t=i.includes(parseInt(a.parentCid,10));if(t){i.push(parseInt(a.cid,10))}return a&&!a.disabled&&parseInt(a.cid,10)!==parseInt(ajaxify.data.category.cid,10)&&!t});e.modal(r,function(a){n.put("/categories/"+ajaxify.data.category.cid,{parentCid:a}).then(()=>{var e=t.filter(function(t){return t&&parseInt(t.cid,10)===parseInt(a,10)});e=e[0];$('button[data-action="removeParent"]').parent().removeClass("hide");$('button[data-action="setParent"]').addClass("hide");var i='<i class="fa '+e.icon+'"></i> '+e.name;$('button[data-action="changeParent"]').html(i).parent().removeClass("hide")})})})};return r});
//# sourceMappingURL=category.js.map