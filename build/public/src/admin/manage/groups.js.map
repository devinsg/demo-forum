{"version":3,"sources":["public/src/admin/manage/groups.js"],"names":["define","categorySelector","api","Groups","intervalId","init","createModal","$","createGroupName","createModalGo","createModalError","handleSearch","on","e","keyCode","click","modal","setTimeout","focus","submitObj","name","val","description","private","is","hidden","post","response","addClass","ajaxify","go","catch","err","utils","hasLanguageKey","status","message","translateHtml","removeClass","el","this","action","attr","groupName","parents","bootbox","confirm","socket","emit","app","alertError","refresh","enableCategorySelectors","each","nameEncoded","selectedCategory","cid","queryEl","doSearch","groupsEl","query","options","sort","groups","parseAndTranslate","categories","data","html","find","remove","append","clearTimeout"],"mappings":"AAAA,aAEAA,OAAO,uBACN,mBACA,OACE,SAAUC,EAAkBC,GAC9B,IAAIC,KAEJ,IAAIC,EAAa,EAEjBD,EAAOE,KAAO,WACb,IAAIC,EAAcC,EAAE,iBACpB,IAAIC,EAAkBD,EAAE,sBACxB,IAAIE,EAAgBF,EAAE,oBACtB,IAAIG,EAAmBH,EAAE,uBAEzBI,IAEAL,EAAYM,GAAG,WAAY,SAAUC,GACpC,GAAIA,EAAEC,UAAY,GAAI,CACrBL,EAAcM,WAIhBR,EAAE,WAAWK,GAAG,QAAS,WACxBN,EAAYU,MAAM,QAClBC,WAAW,WACVT,EAAgBU,SACd,OAGJT,EAAcG,GAAG,QAAS,WACzB,IAAIO,GACHC,KAAMZ,EAAgBa,MACtBC,YAAaf,EAAE,sBAAsBc,MACrCE,QAAShB,EAAE,yBAAyBiB,GAAG,YAAc,EAAI,EACzDC,OAAQlB,EAAE,wBAAwBiB,GAAG,YAAc,EAAI,GAGxDtB,EAAIwB,KAAK,UAAWP,EAAYQ,IAC/BjB,EAAiBkB,SAAS,QAC1BpB,EAAgBa,IAAI,IACpBf,EAAYM,GAAG,kBAAmB,WACjCiB,QAAQC,GAAG,uBAAyBH,EAASP,QAE9Cd,EAAYU,MAAM,UAChBe,MAAOC,IACT,IAAKC,MAAMC,eAAeF,EAAIG,OAAOC,SAAU,CAC9CJ,EAAIG,OAAOC,QAAU,gDAEtB1B,EAAiB2B,cAAcL,EAAIG,OAAOC,SAASE,YAAY,YAIjE/B,EAAE,gBAAgBK,GAAG,QAAS,gBAAiB,WAC9C,IAAI2B,EAAKhC,EAAEiC,MACX,IAAIC,EAASF,EAAGG,KAAK,eACrB,IAAIC,EAAYJ,EAAGK,QAAQ,sBAAsBF,KAAK,kBAEtD,OAAQD,GACP,IAAK,SACJI,QAAQC,QAAQ,gDAAiD,SAAUA,GAC1E,GAAIA,EAAS,CACZC,OAAOC,KAAK,iBACXL,UAAWA,GACT,SAAUX,GACZ,GAAIA,EAAK,CACR,OAAOiB,IAAIC,WAAWlB,EAAII,SAG3BP,QAAQsB,eAIX,SAIHC,KAGD,SAASA,IACR7C,EAAE,gDAAgD8C,KAAK,WACtD,IAAIC,EAAc/C,EAAEiC,MAAMI,QAAQ,uBAAuBF,KAAK,qBAC9DzC,EAAiBI,KAAKE,EAAEiC,MAAO,SAAUe,GACxC1B,QAAQC,GAAG,2BAA6ByB,EAAiBC,IAAM,UAAYF,OAK9E,SAAS3C,IACR,IAAI8C,EAAUlD,EAAE,iBAEhB,SAASmD,IACR,IAAKD,EAAQpC,MAAO,CACnB,OAAOQ,QAAQsB,UAEhB5C,EAAE,eAAeqB,SAAS,QAC1B,IAAI+B,EAAWpD,EAAE,gBACjBwC,OAAOC,KAAK,iBACXY,MAAOH,EAAQpC,MACfwC,SACCC,KAAM,SAEL,SAAU9B,EAAK+B,GACjB,GAAI/B,EAAK,CACR,OAAOiB,IAAIC,WAAWlB,EAAII,SAG3Ba,IAAIe,kBAAkB,sBAAuB,UAC5CD,OAAQA,EACRE,WAAYpC,QAAQqC,KAAKD,YACvB,SAAUE,GACZR,EAASS,KAAK,oBAAoBC,SAClCV,EAASS,KAAK,SAASE,OAAOH,GAC9Bf,QAKHK,EAAQ7C,GAAG,QAAS,WACnB,GAAIR,EAAY,CACfmE,aAAanE,GACbA,EAAa,EAEdA,EAAaa,WAAWyC,EAAU,OAKpC,OAAOvD","file":"public/src/admin/manage/groups.js","sourcesContent":["'use strict';\n\ndefine('admin/manage/groups', [\n\t'categorySelector',\n\t'api',\n], function (categorySelector, api) {\n\tvar\tGroups = {};\n\n\tvar intervalId = 0;\n\n\tGroups.init = function () {\n\t\tvar\tcreateModal = $('#create-modal');\n\t\tvar createGroupName = $('#create-group-name');\n\t\tvar createModalGo = $('#create-modal-go');\n\t\tvar createModalError = $('#create-modal-error');\n\n\t\thandleSearch();\n\n\t\tcreateModal.on('keypress', function (e) {\n\t\t\tif (e.keyCode === 13) {\n\t\t\t\tcreateModalGo.click();\n\t\t\t}\n\t\t});\n\n\t\t$('#create').on('click', function () {\n\t\t\tcreateModal.modal('show');\n\t\t\tsetTimeout(function () {\n\t\t\t\tcreateGroupName.focus();\n\t\t\t}, 250);\n\t\t});\n\n\t\tcreateModalGo.on('click', function () {\n\t\t\tvar submitObj = {\n\t\t\t\tname: createGroupName.val(),\n\t\t\t\tdescription: $('#create-group-desc').val(),\n\t\t\t\tprivate: $('#create-group-private').is(':checked') ? 1 : 0,\n\t\t\t\thidden: $('#create-group-hidden').is(':checked') ? 1 : 0,\n\t\t\t};\n\n\t\t\tapi.post('/groups', submitObj, (response) => {\n\t\t\t\tcreateModalError.addClass('hide');\n\t\t\t\tcreateGroupName.val('');\n\t\t\t\tcreateModal.on('hidden.bs.modal', function () {\n\t\t\t\t\tajaxify.go('admin/manage/groups/' + response.name);\n\t\t\t\t});\n\t\t\t\tcreateModal.modal('hide');\n\t\t\t}).catch((err) => {\n\t\t\t\tif (!utils.hasLanguageKey(err.status.message)) {\n\t\t\t\t\terr.status.message = '[[admin/manage/groups:alerts.create-failure]]';\n\t\t\t\t}\n\t\t\t\tcreateModalError.translateHtml(err.status.message).removeClass('hide');\n\t\t\t});\n\t\t});\n\n\t\t$('.groups-list').on('click', '[data-action]', function () {\n\t\t\tvar el = $(this);\n\t\t\tvar action = el.attr('data-action');\n\t\t\tvar groupName = el.parents('tr[data-groupname]').attr('data-groupname');\n\n\t\t\tswitch (action) {\n\t\t\t\tcase 'delete':\n\t\t\t\t\tbootbox.confirm('[[admin/manage/groups:alerts.confirm-delete]]', function (confirm) {\n\t\t\t\t\t\tif (confirm) {\n\t\t\t\t\t\t\tsocket.emit('groups.delete', {\n\t\t\t\t\t\t\t\tgroupName: groupName,\n\t\t\t\t\t\t\t}, function (err) {\n\t\t\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tajaxify.refresh();\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t});\n\n\t\tenableCategorySelectors();\n\t};\n\n\tfunction enableCategorySelectors() {\n\t\t$('.groups-list [component=\"category-selector\"]').each(function () {\n\t\t\tvar nameEncoded = $(this).parents('[data-name-encoded]').attr('data-name-encoded');\n\t\t\tcategorySelector.init($(this), function (selectedCategory) {\n\t\t\t\tajaxify.go('admin/manage/privileges/' + selectedCategory.cid + '?group=' + nameEncoded);\n\t\t\t});\n\t\t});\n\t}\n\n\tfunction handleSearch() {\n\t\tvar queryEl = $('#group-search');\n\n\t\tfunction doSearch() {\n\t\t\tif (!queryEl.val()) {\n\t\t\t\treturn ajaxify.refresh();\n\t\t\t}\n\t\t\t$('.pagination').addClass('hide');\n\t\t\tvar groupsEl = $('.groups-list');\n\t\t\tsocket.emit('groups.search', {\n\t\t\t\tquery: queryEl.val(),\n\t\t\t\toptions: {\n\t\t\t\t\tsort: 'date',\n\t\t\t\t},\n\t\t\t}, function (err, groups) {\n\t\t\t\tif (err) {\n\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t}\n\n\t\t\t\tapp.parseAndTranslate('admin/manage/groups', 'groups', {\n\t\t\t\t\tgroups: groups,\n\t\t\t\t\tcategories: ajaxify.data.categories,\n\t\t\t\t}, function (html) {\n\t\t\t\t\tgroupsEl.find('[data-groupname]').remove();\n\t\t\t\t\tgroupsEl.find('tbody').append(html);\n\t\t\t\t\tenableCategorySelectors();\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tqueryEl.on('keyup', function () {\n\t\t\tif (intervalId) {\n\t\t\t\tclearTimeout(intervalId);\n\t\t\t\tintervalId = 0;\n\t\t\t}\n\t\t\tintervalId = setTimeout(doSearch, 200);\n\t\t});\n\t}\n\n\n\treturn Groups;\n});\n"]}