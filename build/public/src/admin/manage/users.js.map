{"version":3,"sources":["public/src/admin/manage/users.js"],"names":["define","translator","Benchpress","autocomplete","api","slugify","Users","init","$","val","ajaxify","data","resultsPerPage","on","query","utils","params","qs","buildSearchQuery","go","window","location","pathname","getSelectedUids","uids","each","this","is","push","attr","update","className","state","parents","find","toggleClass","unselectAll","prop","removeSelected","remove","done","successMessage","flag","err","app","alertError","message","alertSuccess","onSuccess","length","socket","emit","parse","html","modal","bootbox","dialog","title","onEscape","group","ev","ui","uid","target","put","item","slug","undefined","then","nameEscaped","escape","displayName","parseAndTranslate","users","groups","append","groupCard","groupName","del","confirm","Promise","all","map","show","buttons","close","label","submit","callback","formData","serializeArray","reduce","cur","name","value","until","Date","now","parseInt","unit","reason","delete","refresh","handleUserCreate","cancel","create","createUser","call","focus","username","document","getElementById","email","password","passwordAgain","errorEl","translateHtml","removeClass","user","post","catch","status","handleSearch","handleInvite","handleSort","handleFilter","timeoutId","doSearch","loadSearchPage","searchBy","page","clearTimeout","setTimeout","decodeURIComponent","param","get","config","relative_path","renderSearchResults","fail","xhrErr","responseJSON","error","pagination","replaceWith","timeago","addClass","compile","matchCount","timing","prompt","$this","sortBy","sortDirection","reverse","getFilters","filters","currentFilters","hasClass","changed","forEach","filter","i"],"mappings":"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","file":"public/src/admin/manage/users.js","sourcesContent":["'use strict';\n\ndefine('admin/manage/users', [\n\t'translator', 'benchpress', 'autocomplete', 'api', 'slugify',\n], function (translator, Benchpress, autocomplete, api, slugify) {\n\tvar Users = {};\n\n\tUsers.init = function () {\n\t\t$('#results-per-page').val(ajaxify.data.resultsPerPage).on('change', function () {\n\t\t\tvar query = utils.params();\n\t\t\tquery.resultsPerPage = $('#results-per-page').val();\n\t\t\tvar qs = buildSearchQuery(query);\n\t\t\tajaxify.go(window.location.pathname + '?' + qs);\n\t\t});\n\n\t\tfunction getSelectedUids() {\n\t\t\tvar uids = [];\n\n\t\t\t$('.users-table [component=\"user/select/single\"]').each(function () {\n\t\t\t\tif ($(this).is(':checked')) {\n\t\t\t\t\tuids.push($(this).attr('data-uid'));\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn uids;\n\t\t}\n\n\t\tfunction update(className, state) {\n\t\t\t$('.users-table [component=\"user/select/single\"]:checked').parents('.user-row').find(className).each(function () {\n\t\t\t\t$(this).toggleClass('hidden', !state);\n\t\t\t});\n\t\t}\n\n\t\tfunction unselectAll() {\n\t\t\t$('.users-table [component=\"user/select/single\"]').prop('checked', false);\n\t\t\t$('.users-table [component=\"user/select/all\"]').prop('checked', false);\n\t\t}\n\n\t\tfunction removeSelected() {\n\t\t\t$('.users-table [component=\"user/select/single\"]:checked').parents('.user-row').remove();\n\t\t}\n\n\t\t// use onSuccess instead\n\t\tfunction done(successMessage, className, flag) {\n\t\t\treturn function (err) {\n\t\t\t\tif (err) {\n\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t}\n\t\t\t\tapp.alertSuccess(successMessage);\n\t\t\t\tif (className) {\n\t\t\t\t\tupdate(className, flag);\n\t\t\t\t}\n\t\t\t\tunselectAll();\n\t\t\t};\n\t\t}\n\n\t\tfunction onSuccess(successMessage, className, flag) {\n\t\t\tapp.alertSuccess(successMessage);\n\t\t\tif (className) {\n\t\t\t\tupdate(className, flag);\n\t\t\t}\n\t\t\tunselectAll();\n\t\t}\n\n\t\t$('[component=\"user/select/all\"]').on('click', function () {\n\t\t\t$('.users-table [component=\"user/select/single\"]').prop('checked', $(this).is(':checked'));\n\t\t});\n\n\t\t$('.manage-groups').on('click', function () {\n\t\t\tvar uids = getSelectedUids();\n\t\t\tif (!uids.length) {\n\t\t\t\tapp.alertError('[[error:no-users-selected]]');\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tsocket.emit('admin.user.loadGroups', uids, function (err, data) {\n\t\t\t\tif (err) {\n\t\t\t\t\treturn app.alertError(err);\n\t\t\t\t}\n\t\t\t\tBenchpress.parse('admin/partials/manage_user_groups', data, function (html) {\n\t\t\t\t\tvar modal = bootbox.dialog({\n\t\t\t\t\t\tmessage: html,\n\t\t\t\t\t\ttitle: '[[admin/manage/users:manage-groups]]',\n\t\t\t\t\t\tonEscape: true,\n\t\t\t\t\t});\n\t\t\t\t\tmodal.on('shown.bs.modal', function () {\n\t\t\t\t\t\tautocomplete.group(modal.find('.group-search'), function (ev, ui) {\n\t\t\t\t\t\t\tvar uid = $(ev.target).attr('data-uid');\n\t\t\t\t\t\t\tapi.put('/groups/' + ui.item.group.slug + '/membership/' + uid, undefined).then(() => {\n\t\t\t\t\t\t\t\tui.item.group.nameEscaped = translator.escape(ui.item.group.displayName);\n\t\t\t\t\t\t\t\tapp.parseAndTranslate('admin/partials/manage_user_groups', { users: [{ groups: [ui.item.group] }] }, function (html) {\n\t\t\t\t\t\t\t\t\t$('[data-uid=' + uid + '] .group-area').append(html.find('.group-area').html());\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t\tmodal.on('click', '.group-area a', function () {\n\t\t\t\t\t\tmodal.modal('hide');\n\t\t\t\t\t});\n\t\t\t\t\tmodal.on('click', '.remove-group-icon', function () {\n\t\t\t\t\t\tvar groupCard = $(this).parents('[data-group-name]');\n\t\t\t\t\t\tvar groupName = groupCard.attr('data-group-name');\n\t\t\t\t\t\tvar uid = $(this).parents('[data-uid]').attr('data-uid');\n\t\t\t\t\t\tapi.del('/groups/' + slugify(groupName) + '/membership/' + uid).then(() => {\n\t\t\t\t\t\t\tgroupCard.remove();\n\t\t\t\t\t\t});\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\n\t\t$('.ban-user').on('click', function () {\n\t\t\tvar uids = getSelectedUids();\n\t\t\tif (!uids.length) {\n\t\t\t\tapp.alertError('[[error:no-users-selected]]');\n\t\t\t\treturn false;\t// specifically to keep the menu open\n\t\t\t}\n\n\t\t\tbootbox.confirm((uids.length > 1 ? '[[admin/manage/users:alerts.confirm-ban-multi]]' : '[[admin/manage/users:alerts.confirm-ban]]'), function (confirm) {\n\t\t\t\tif (confirm) {\n\t\t\t\t\tPromise.all(uids.map(function (uid) {\n\t\t\t\t\t\treturn api.put('/users/' + uid + '/ban');\n\t\t\t\t\t})).then(() => {\n\t\t\t\t\t\tonSuccess('[[admin/manage/users:alerts.ban-success]]', '.ban', true);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\t$('.ban-user-temporary').on('click', function () {\n\t\t\tvar uids = getSelectedUids();\n\t\t\tif (!uids.length) {\n\t\t\t\tapp.alertError('[[error:no-users-selected]]');\n\t\t\t\treturn false;\t// specifically to keep the menu open\n\t\t\t}\n\n\t\t\tBenchpress.parse('admin/partials/temporary-ban', {}, function (html) {\n\t\t\t\tbootbox.dialog({\n\t\t\t\t\tclassName: 'ban-modal',\n\t\t\t\t\ttitle: '[[user:ban_account]]',\n\t\t\t\t\tmessage: html,\n\t\t\t\t\tshow: true,\n\t\t\t\t\tbuttons: {\n\t\t\t\t\t\tclose: {\n\t\t\t\t\t\t\tlabel: '[[global:close]]',\n\t\t\t\t\t\t\tclassName: 'btn-link',\n\t\t\t\t\t\t},\n\t\t\t\t\t\tsubmit: {\n\t\t\t\t\t\t\tlabel: '[[admin/manage/users:alerts.button-ban-x, ' + uids.length + ']]',\n\t\t\t\t\t\t\tcallback: function () {\n\t\t\t\t\t\t\t\tvar formData = $('.ban-modal form').serializeArray().reduce(function (data, cur) {\n\t\t\t\t\t\t\t\t\tdata[cur.name] = cur.value;\n\t\t\t\t\t\t\t\t\treturn data;\n\t\t\t\t\t\t\t\t}, {});\n\t\t\t\t\t\t\t\tvar until = formData.length > 0 ? (Date.now() + (formData.length * 1000 * 60 * 60 * (parseInt(formData.unit, 10) ? 24 : 1))) : 0;\n\n\t\t\t\t\t\t\t\tPromise.all(uids.map(function (uid) {\n\t\t\t\t\t\t\t\t\treturn api.put('/users/' + uid + '/ban', {\n\t\t\t\t\t\t\t\t\t\tuntil: until,\n\t\t\t\t\t\t\t\t\t\treason: formData.reason,\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t})).then(() => {\n\t\t\t\t\t\t\t\t\tonSuccess('[[admin/manage/users:alerts.ban-success]]', '.ban', true);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\n\t\t$('.unban-user').on('click', function () {\n\t\t\tvar uids = getSelectedUids();\n\t\t\tif (!uids.length) {\n\t\t\t\tapp.alertError('[[error:no-users-selected]]');\n\t\t\t\treturn false;\t// specifically to keep the menu open\n\t\t\t}\n\n\t\t\tPromise.all(uids.map(function (uid) {\n\t\t\t\treturn api.delete('/users/' + uid + '/ban');\n\t\t\t})).then(() => {\n\t\t\t\tonSuccess('[[admin/manage/users:alerts.unban-success]]', '.ban', false);\n\t\t\t});\n\t\t});\n\n\t\t$('.reset-lockout').on('click', function () {\n\t\t\tvar uids = getSelectedUids();\n\t\t\tif (!uids.length) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tsocket.emit('admin.user.resetLockouts', uids, done('[[admin/manage/users:alerts.lockout-reset-success]]'));\n\t\t});\n\n\t\t$('.validate-email').on('click', function () {\n\t\t\tvar uids = getSelectedUids();\n\t\t\tif (!uids.length) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tbootbox.confirm('[[admin/manage/users:alerts.confirm-validate-email]]', function (confirm) {\n\t\t\t\tif (!confirm) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tsocket.emit('admin.user.validateEmail', uids, function (err) {\n\t\t\t\t\tif (err) {\n\t\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t\t}\n\t\t\t\t\tapp.alertSuccess('[[admin/manage/users:alerts.validate-email-success]]');\n\t\t\t\t\tupdate('.notvalidated', false);\n\t\t\t\t\tupdate('.validated', true);\n\t\t\t\t\tunselectAll();\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\n\t\t$('.send-validation-email').on('click', function () {\n\t\t\tvar uids = getSelectedUids();\n\t\t\tif (!uids.length) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tsocket.emit('admin.user.sendValidationEmail', uids, function (err) {\n\t\t\t\tif (err) {\n\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t}\n\t\t\t\tapp.alertSuccess('[[notifications:email-confirm-sent]]');\n\t\t\t});\n\t\t});\n\n\t\t$('.password-reset-email').on('click', function () {\n\t\t\tvar uids = getSelectedUids();\n\t\t\tif (!uids.length) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tbootbox.confirm('[[admin/manage/users:alerts.password-reset-confirm]]', function (confirm) {\n\t\t\t\tif (confirm) {\n\t\t\t\t\tsocket.emit('admin.user.sendPasswordResetEmail', uids, done('[[notifications:email-confirm-sent]]'));\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\t$('.force-password-reset').on('click', function () {\n\t\t\tvar uids = getSelectedUids();\n\t\t\tif (!uids.length) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tbootbox.confirm('[[admin/manage/users:alerts.confirm-force-password-reset]]', function (confirm) {\n\t\t\t\tif (confirm) {\n\t\t\t\t\tsocket.emit('admin.user.forcePasswordReset', uids, done('[[admin/manage/users:alerts.validate-force-password-reset-success]]'));\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\t$('.delete-user').on('click', function () {\n\t\t\tvar uids = getSelectedUids();\n\t\t\tif (!uids.length) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tbootbox.confirm('[[admin/manage/users:alerts.confirm-delete]]', function (confirm) {\n\t\t\t\tif (confirm) {\n\t\t\t\t\tsocket.emit('admin.user.deleteUsers', uids, function (err) {\n\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tapp.alertSuccess('[[admin/manage/users:alerts.delete-success]]');\n\t\t\t\t\t\tremoveSelected();\n\t\t\t\t\t\tunselectAll();\n\t\t\t\t\t\tif (!$('.users-table [component=\"user/select/single\"]').length) {\n\t\t\t\t\t\t\tajaxify.refresh();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\t$('.delete-user-content').on('click', function () {\n\t\t\tvar uids = getSelectedUids();\n\t\t\tif (!uids.length) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tbootbox.confirm('[[admin/manage/users:alerts.confirm-delete-content]]', function (confirm) {\n\t\t\t\tif (confirm) {\n\t\t\t\t\tsocket.emit('admin.user.deleteUsersContent', uids, function (err) {\n\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tapp.alertSuccess('[[admin/manage/users:alerts.delete-content-success]]');\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\t$('.delete-user-and-content').on('click', function () {\n\t\t\tvar uids = getSelectedUids();\n\t\t\tif (!uids.length) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tbootbox.confirm('[[admin/manage/users:alerts.confirm-purge]]', function (confirm) {\n\t\t\t\tif (confirm) {\n\t\t\t\t\tsocket.emit('admin.user.deleteUsersAndContent', uids, function (err) {\n\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tapp.alertSuccess('[[admin/manage/users:alerts.delete-success]]');\n\t\t\t\t\t\tremoveSelected();\n\t\t\t\t\t\tunselectAll();\n\t\t\t\t\t\tif (!$('.users-table [component=\"user/select/single\"]').length) {\n\t\t\t\t\t\t\tajaxify.refresh();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\tfunction handleUserCreate() {\n\t\t\t$('[data-action=\"create\"]').on('click', function () {\n\t\t\t\tBenchpress.parse('admin/partials/create_user_modal', {}, function (html) {\n\t\t\t\t\tvar modal = bootbox.dialog({\n\t\t\t\t\t\tmessage: html,\n\t\t\t\t\t\ttitle: '[[admin/manage/users:alerts.create]]',\n\t\t\t\t\t\tonEscape: true,\n\t\t\t\t\t\tbuttons: {\n\t\t\t\t\t\t\tcancel: {\n\t\t\t\t\t\t\t\tlabel: '[[admin/manage/users:alerts.button-cancel]]',\n\t\t\t\t\t\t\t\tclassName: 'btn-link',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tcreate: {\n\t\t\t\t\t\t\t\tlabel: '[[admin/manage/users:alerts.button-create]]',\n\t\t\t\t\t\t\t\tclassName: 'btn-primary',\n\t\t\t\t\t\t\t\tcallback: function () {\n\t\t\t\t\t\t\t\t\tcreateUser.call(this);\n\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t\tmodal.on('shown.bs.modal', function () {\n\t\t\t\t\t\tmodal.find('#create-user-name').focus();\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t\treturn false;\n\t\t\t});\n\t\t}\n\n\t\tfunction createUser() {\n\t\t\tvar modal = this;\n\t\t\tvar username = document.getElementById('create-user-name').value;\n\t\t\tvar email = document.getElementById('create-user-email').value;\n\t\t\tvar password = document.getElementById('create-user-password').value;\n\t\t\tvar passwordAgain = document.getElementById('create-user-password-again').value;\n\n\t\t\tvar errorEl = $('#create-modal-error');\n\n\t\t\tif (password !== passwordAgain) {\n\t\t\t\treturn errorEl.translateHtml('[[admin/manage/users:alerts.error-x, [[admin/manage/users:alerts.error-passwords-different]]]]').removeClass('hide');\n\t\t\t}\n\n\t\t\tvar user = {\n\t\t\t\tusername: username,\n\t\t\t\temail: email,\n\t\t\t\tpassword: password,\n\t\t\t};\n\n\t\t\tapi.post('/users', user)\n\t\t\t\t.then(() => {\n\t\t\t\t\tmodal.modal('hide');\n\t\t\t\t\tmodal.on('hidden.bs.modal', function () {\n\t\t\t\t\t\tajaxify.refresh();\n\t\t\t\t\t});\n\t\t\t\t\tapp.alertSuccess('[[admin/manage/users:alerts.create-success]]');\n\t\t\t\t})\n\t\t\t\t.catch(err => errorEl.translateHtml('[[admin/manage/users:alerts.error-x, ' + err.status.message + ']]').removeClass('hidden'));\n\t\t}\n\n\t\thandleSearch();\n\n\t\thandleUserCreate();\n\n\t\thandleInvite();\n\n\t\thandleSort();\n\t\thandleFilter();\n\t};\n\n\tfunction handleSearch() {\n\t\tvar timeoutId = 0;\n\t\tfunction doSearch() {\n\t\t\t$('.fa-spinner').removeClass('hidden');\n\t\t\tloadSearchPage({\n\t\t\t\tsearchBy: $('#user-search-by').val(),\n\t\t\t\tquery: $('#user-search').val(),\n\t\t\t\tpage: 1,\n\t\t\t});\n\t\t}\n\t\t$('#user-search').on('keyup', function () {\n\t\t\tif (timeoutId !== 0) {\n\t\t\t\tclearTimeout(timeoutId);\n\t\t\t\ttimeoutId = 0;\n\t\t\t}\n\t\t\ttimeoutId = setTimeout(doSearch, 250);\n\t\t});\n\t\t$('#user-search-by').on('change', function () {\n\t\t\tdoSearch();\n\t\t});\n\t}\n\n\tfunction loadSearchPage(query) {\n\t\tvar params = utils.params();\n\t\tparams.searchBy = query.searchBy;\n\t\tparams.query = query.query;\n\t\tparams.page = query.page;\n\t\tvar qs = decodeURIComponent($.param(params));\n\t\t$.get(config.relative_path + '/api/admin/manage/users?' + qs, renderSearchResults).fail(function (xhrErr) {\n\t\t\tif (xhrErr && xhrErr.responseJSON && xhrErr.responseJSON.error) {\n\t\t\t\tapp.alertError(xhrErr.responseJSON.error);\n\t\t\t}\n\t\t});\n\t}\n\n\tfunction renderSearchResults(data) {\n\t\tBenchpress.parse('partials/paginator', { pagination: data.pagination }, function (html) {\n\t\t\t$('.pagination-container').replaceWith(html);\n\t\t});\n\n\t\tapp.parseAndTranslate('admin/manage/users', 'users', data, function (html) {\n\t\t\t$('.users-table tbody tr').remove();\n\t\t\t$('.users-table tbody').append(html);\n\t\t\thtml.find('.timeago').timeago();\n\t\t\t$('.fa-spinner').addClass('hidden');\n\t\t\tif (!$('#user-search').val()) {\n\t\t\t\t$('#user-found-notify').addClass('hidden');\n\t\t\t\t$('#user-notfound-notify').addClass('hidden');\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (data && data.users.length === 0) {\n\t\t\t\t$('#user-notfound-notify').translateHtml('[[admin/manage/users:search.not-found]]')\n\t\t\t\t\t.removeClass('hidden');\n\t\t\t\t$('#user-found-notify').addClass('hidden');\n\t\t\t} else {\n\t\t\t\t$('#user-found-notify').translateHtml(\n\t\t\t\t\ttranslator.compile('admin/manage/users:alerts.x-users-found', data.matchCount, data.timing)\n\t\t\t\t).removeClass('hidden');\n\t\t\t\t$('#user-notfound-notify').addClass('hidden');\n\t\t\t}\n\t\t});\n\t}\n\n\tfunction handleInvite() {\n\t\t$('[component=\"user/invite\"]').on('click', function () {\n\t\t\tbootbox.prompt('[[admin/manage/users:alerts.prompt-email]]', function (email) {\n\t\t\t\tif (!email) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tsocket.emit('user.invite', email, function (err) {\n\t\t\t\t\tif (err) {\n\t\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t\t}\n\t\t\t\t\tapp.alertSuccess('[[admin/manage/users:alerts.email-sent-to, ' + email + ']]');\n\t\t\t\t});\n\t\t\t});\n\t\t\treturn false;\n\t\t});\n\t}\n\n\tfunction buildSearchQuery(params) {\n\t\tif ($('#user-search').val()) {\n\t\t\tparams.query = $('#user-search').val();\n\t\t\tparams.searchBy = $('#user-search-by').val();\n\t\t} else {\n\t\t\tdelete params.query;\n\t\t\tdelete params.searchBy;\n\t\t}\n\n\t\treturn decodeURIComponent($.param(params));\n\t}\n\n\tfunction handleSort() {\n\t\t$('.users-table thead th').on('click', function () {\n\t\t\tvar $this = $(this);\n\t\t\tvar sortBy = $this.attr('data-sort');\n\t\t\tif (!sortBy) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar params = utils.params();\n\t\t\tparams.sortBy = sortBy;\n\t\t\tif (ajaxify.data.sortBy === sortBy) {\n\t\t\t\tparams.sortDirection = ajaxify.data.reverse ? 'asc' : 'desc';\n\t\t\t} else {\n\t\t\t\tparams.sortDirection = 'desc';\n\t\t\t}\n\n\t\t\tvar qs = buildSearchQuery(params);\n\t\t\tajaxify.go('admin/manage/users?' + qs);\n\t\t});\n\t}\n\n\tfunction getFilters() {\n\t\tvar filters = [];\n\t\t$('#filter-by').find('[data-filter-by]').each(function () {\n\t\t\tif ($(this).find('.fa-check').length) {\n\t\t\t\tfilters.push($(this).attr('data-filter-by'));\n\t\t\t}\n\t\t});\n\t\treturn filters;\n\t}\n\n\tfunction handleFilter() {\n\t\tvar currentFilters = getFilters();\n\t\t$('#filter-by').on('click', 'li', function () {\n\t\t\tvar $this = $(this);\n\t\t\t$this.find('i').toggleClass('fa-check', !$this.find('i').hasClass('fa-check'));\n\t\t\treturn false;\n\t\t});\n\n\t\t$('#filter-by').on('hidden.bs.dropdown', function () {\n\t\t\tvar filters = getFilters();\n\t\t\tvar changed = filters.length !== currentFilters.length;\n\t\t\tif (filters.length === currentFilters.length) {\n\t\t\t\tfilters.forEach(function (filter, i) {\n\t\t\t\t\tif (filter !== currentFilters[i]) {\n\t\t\t\t\t\tchanged = true;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\tcurrentFilters = getFilters();\n\t\t\tif (changed) {\n\t\t\t\tvar params = utils.params();\n\t\t\t\tparams.filters = filters;\n\t\t\t\tvar qs = buildSearchQuery(params);\n\t\t\t\tajaxify.go('admin/manage/users?' + qs);\n\t\t\t}\n\t\t});\n\t}\n\n\treturn Users;\n});\n"]}