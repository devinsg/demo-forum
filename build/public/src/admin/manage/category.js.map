{"version":3,"sources":["public/src/admin/manage/category.js"],"names":["define","uploader","iconSelect","categorySelector","Benchpress","api","Category","updateHash","init","$","each","$this","this","val","attr","selectedCategory","ajaxify","go","cid","handleTags","on","ev","modified","target","css","$inputEl","previewEl","parents","find","tags","split","length","parseInt","app","alertError","data","category","put","then","res","flags","_unsaved","alert","title","message","name","type","timeout","e","preventDefault","parse","topic_count","html","modal","bootbox","dialog","size","buttons","save","label","className","callback","prop","intervalId","setInterval","socket","emit","err","count","percent","Math","max","width","del","clearInterval","alertSuccess","allCategories","categories","selectedCid","fromCid","toCid","copyParent","refresh","inputEl","show","route","config","relative_path","params","imageUrlOnServer","previewBox","parent","siblings","Date","getTime","addClass","hide","launchParentSelector","parentCid","removeClass","disabled","translateText","toggleClass","el","value","is","tagEl","tagsinput","confirmKeys","trimValue","tagWhitelist","forEach","tag","filter","isChild","includes","push","buttonHtml","icon"],"mappings":"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","file":"public/src/admin/manage/category.js","sourcesContent":["'use strict';\n\ndefine('admin/manage/category', [\n\t'uploader',\n\t'iconSelect',\n\t'categorySelector',\n\t'benchpress',\n\t'api',\n], function (uploader, iconSelect, categorySelector, Benchpress, api) {\n\tvar\tCategory = {};\n\tvar updateHash = {};\n\n\tCategory.init = function () {\n\t\t$('#category-settings select').each(function () {\n\t\t\tvar $this = $(this);\n\t\t\t$this.val($this.attr('data-value'));\n\t\t});\n\n\t\tcategorySelector.init($('[component=\"category-selector\"]'), function (selectedCategory) {\n\t\t\tajaxify.go('admin/manage/categories/' + selectedCategory.cid);\n\t\t});\n\n\t\thandleTags();\n\n\t\t$('#category-settings input, #category-settings select').on('change', function (ev) {\n\t\t\tmodified(ev.target);\n\t\t});\n\n\t\t$('[data-name=\"imageClass\"]').on('change', function () {\n\t\t\t$('.category-preview').css('background-size', $(this).val());\n\t\t});\n\n\t\t$('[data-name=\"bgColor\"], [data-name=\"color\"]').on('input', function () {\n\t\t\tvar $inputEl = $(this);\n\t\t\tvar previewEl = $inputEl.parents('[data-cid]').find('.category-preview');\n\t\t\tif ($inputEl.attr('data-name') === 'bgColor') {\n\t\t\t\tpreviewEl.css('background-color', $inputEl.val());\n\t\t\t} else if ($inputEl.attr('data-name') === 'color') {\n\t\t\t\tpreviewEl.css('color', $inputEl.val());\n\t\t\t}\n\n\t\t\tmodified($inputEl[0]);\n\t\t});\n\n\t\t$('#save').on('click', function () {\n\t\t\tvar tags = $('#tag-whitelist').val() ? $('#tag-whitelist').val().split(',') : [];\n\t\t\tif (tags.length && tags.length < parseInt($('#cid-min-tags').val(), 10)) {\n\t\t\t\treturn app.alertError('[[admin/manage/categories:alert.not-enough-whitelisted-tags]]');\n\t\t\t}\n\n\t\t\tvar cid = ajaxify.data.category.cid;\n\t\t\tapi.put('/categories/' + cid, updateHash).then((res) => {\n\t\t\t\tapp.flags._unsaved = false;\n\t\t\t\tapp.alert({\n\t\t\t\t\ttitle: 'Updated Categories',\n\t\t\t\t\tmessage: 'Category \"' + res.name + '\" was successfully updated.',\n\t\t\t\t\ttype: 'success',\n\t\t\t\t\ttimeout: 5000,\n\t\t\t\t});\n\t\t\t\tupdateHash = {};\n\t\t\t});\n\n\t\t\treturn false;\n\t\t});\n\n\t\t$('.purge').on('click', function (e) {\n\t\t\te.preventDefault();\n\n\t\t\tBenchpress.parse('admin/partials/categories/purge', {\n\t\t\t\tname: ajaxify.data.category.name,\n\t\t\t\ttopic_count: ajaxify.data.category.topic_count,\n\t\t\t}, function (html) {\n\t\t\t\tvar modal = bootbox.dialog({\n\t\t\t\t\ttitle: '[[admin/manage/categories:purge]]',\n\t\t\t\t\tmessage: html,\n\t\t\t\t\tsize: 'large',\n\t\t\t\t\tbuttons: {\n\t\t\t\t\t\tsave: {\n\t\t\t\t\t\t\tlabel: '[[modules:bootbox.confirm]]',\n\t\t\t\t\t\t\tclassName: 'btn-primary',\n\t\t\t\t\t\t\tcallback: function () {\n\t\t\t\t\t\t\t\tmodal.find('.modal-footer button').prop('disabled', true);\n\n\t\t\t\t\t\t\t\tvar intervalId = setInterval(function () {\n\t\t\t\t\t\t\t\t\tsocket.emit('categories.getTopicCount', ajaxify.data.category.cid, function (err, count) {\n\t\t\t\t\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\t\t\t\t\treturn app.alertError(err);\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tvar percent = 0;\n\t\t\t\t\t\t\t\t\t\tif (ajaxify.data.category.topic_count > 0) {\n\t\t\t\t\t\t\t\t\t\t\tpercent = Math.max(0, (1 - (count / ajaxify.data.category.topic_count))) * 100;\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tmodal.find('.progress-bar').css({ width: percent + '%' });\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}, 1000);\n\n\t\t\t\t\t\t\t\tapi.del('/categories/' + ajaxify.data.category.cid).then(() => {\n\t\t\t\t\t\t\t\t\tif (intervalId) {\n\t\t\t\t\t\t\t\t\t\tclearInterval(intervalId);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tmodal.modal('hide');\n\t\t\t\t\t\t\t\t\tapp.alertSuccess('[[admin/manage/categories:alert.purge-success]]');\n\t\t\t\t\t\t\t\t\tajaxify.go('admin/manage/categories');\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\n\t\t$('.copy-settings').on('click', function () {\n\t\t\tsocket.emit('categories.getSelectCategories', {}, function (err, allCategories) {\n\t\t\t\tif (err) {\n\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t}\n\n\t\t\t\tBenchpress.parse('admin/partials/categories/copy-settings', {\n\t\t\t\t\tcategories: allCategories,\n\t\t\t\t}, function (html) {\n\t\t\t\t\tvar selectedCid;\n\t\t\t\t\tvar modal = bootbox.dialog({\n\t\t\t\t\t\ttitle: '[[modules:composer.select_category]]',\n\t\t\t\t\t\tmessage: html,\n\t\t\t\t\t\tbuttons: {\n\t\t\t\t\t\t\tsave: {\n\t\t\t\t\t\t\t\tlabel: '[[modules:bootbox.confirm]]',\n\t\t\t\t\t\t\t\tclassName: 'btn-primary',\n\t\t\t\t\t\t\t\tcallback: function () {\n\t\t\t\t\t\t\t\t\tif (!selectedCid || parseInt(selectedCid, 10) === parseInt(ajaxify.data.category.cid, 10)) {\n\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tsocket.emit('admin.categories.copySettingsFrom', {\n\t\t\t\t\t\t\t\t\t\tfromCid: selectedCid,\n\t\t\t\t\t\t\t\t\t\ttoCid: ajaxify.data.category.cid,\n\t\t\t\t\t\t\t\t\t\tcopyParent: modal.find('#copyParent').prop('checked'),\n\t\t\t\t\t\t\t\t\t}, function (err) {\n\t\t\t\t\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tmodal.modal('hide');\n\t\t\t\t\t\t\t\t\t\tapp.alertSuccess('[[admin/manage/categories:alert.copy-success]]');\n\t\t\t\t\t\t\t\t\t\tajaxify.refresh();\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t\tmodal.find('.modal-footer button').prop('disabled', true);\n\t\t\t\t\tcategorySelector.init(modal.find('[component=\"category-selector\"]'), function (selectedCategory) {\n\t\t\t\t\t\tselectedCid = selectedCategory && selectedCategory.cid;\n\t\t\t\t\t\tif (selectedCid) {\n\t\t\t\t\t\t\tmodal.find('.modal-footer button').prop('disabled', false);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t\treturn false;\n\t\t\t});\n\t\t});\n\n\t\t$('.upload-button').on('click', function () {\n\t\t\tvar inputEl = $(this);\n\t\t\tvar cid = inputEl.attr('data-cid');\n\n\t\t\tuploader.show({\n\t\t\t\ttitle: '[[admin/manage/categories:alert.upload-image]]',\n\t\t\t\troute: config.relative_path + '/api/admin/category/uploadpicture',\n\t\t\t\tparams: { cid: cid },\n\t\t\t}, function (imageUrlOnServer) {\n\t\t\t\t$('#category-image').val(imageUrlOnServer);\n\t\t\t\tvar previewBox = inputEl.parent().parent().siblings('.category-preview');\n\t\t\t\tpreviewBox.css('background', 'url(' + imageUrlOnServer + '?' + new Date().getTime() + ')');\n\n\t\t\t\tmodified($('#category-image'));\n\t\t\t});\n\t\t});\n\n\t\t$('#category-image').on('change', function () {\n\t\t\t$('.category-preview').css('background-image', $(this).val() ? ('url(\"' + $(this).val() + '\")') : '');\n\t\t\tmodified($('#category-image'));\n\t\t});\n\n\t\t$('.delete-image').on('click', function (e) {\n\t\t\te.preventDefault();\n\n\t\t\tvar inputEl = $('#category-image');\n\t\t\tvar previewBox = $('.category-preview');\n\n\t\t\tinputEl.val('');\n\t\t\tpreviewBox.css('background-image', '');\n\t\t\tmodified(inputEl[0]);\n\t\t\t$(this).parent().addClass('hide').hide();\n\t\t});\n\n\t\t$('.category-preview').on('click', function () {\n\t\t\ticonSelect.init($(this).find('i'), modified);\n\t\t});\n\n\t\t$('[type=\"checkbox\"]').on('change', function () {\n\t\t\tmodified($(this));\n\t\t});\n\n\t\t$('button[data-action=\"setParent\"], button[data-action=\"changeParent\"]').on('click', Category.launchParentSelector);\n\t\t$('button[data-action=\"removeParent\"]').on('click', function () {\n\t\t\tapi.put('/categories/' + ajaxify.data.category.cid, {\n\t\t\t\tparentCid: 0,\n\t\t\t}).then(() => {\n\t\t\t\t$('button[data-action=\"removeParent\"]').parent().addClass('hide');\n\t\t\t\t$('button[data-action=\"changeParent\"]').parent().addClass('hide');\n\t\t\t\t$('button[data-action=\"setParent\"]').removeClass('hide');\n\t\t\t});\n\t\t});\n\t\t$('button[data-action=\"toggle\"]').on('click', function () {\n\t\t\tvar $this = $(this);\n\t\t\tvar disabled = $this.attr('data-disabled') === '1';\n\t\t\tapi.put('/categories/' + ajaxify.data.category.cid, {\n\t\t\t\tdisabled: disabled ? 0 : 1,\n\t\t\t}).then(() => {\n\t\t\t\t$this.translateText(!disabled ? '[[admin/manage/categories:enable]]' : '[[admin/manage/categories:disable]]');\n\t\t\t\t$this.toggleClass('btn-primary', !disabled).toggleClass('btn-danger', disabled);\n\t\t\t\t$this.attr('data-disabled', disabled ? 0 : 1);\n\t\t\t});\n\t\t});\n\t};\n\n\tfunction modified(el) {\n\t\tvar value;\n\t\tif ($(el).is(':checkbox')) {\n\t\t\tvalue = $(el).is(':checked') ? 1 : 0;\n\t\t} else {\n\t\t\tvalue = $(el).val();\n\t\t}\n\n\t\tupdateHash[$(el).attr('data-name')] = value;\n\n\t\tapp.flags = app.flags || {};\n\t\tapp.flags._unsaved = true;\n\t}\n\n\tfunction handleTags() {\n\t\tvar tagEl = $('#tag-whitelist');\n\t\ttagEl.tagsinput({\n\t\t\tconfirmKeys: [13, 44],\n\t\t\ttrimValue: true,\n\t\t});\n\n\t\tajaxify.data.category.tagWhitelist.forEach(function (tag) {\n\t\t\ttagEl.tagsinput('add', tag);\n\t\t});\n\n\t\ttagEl.on('itemAdded itemRemoved', function () {\n\t\t\tmodified(tagEl);\n\t\t});\n\t}\n\n\tCategory.launchParentSelector = function () {\n\t\tsocket.emit('categories.getSelectCategories', {}, function (err, allCategories) {\n\t\t\tif (err) {\n\t\t\t\treturn app.alertError(err.message);\n\t\t\t}\n\t\t\tvar parents = [parseInt(ajaxify.data.category.cid, 10)];\n\t\t\tvar categories = allCategories.filter(function (category) {\n\t\t\t\tvar isChild = parents.includes(parseInt(category.parentCid, 10));\n\t\t\t\tif (isChild) {\n\t\t\t\t\tparents.push(parseInt(category.cid, 10));\n\t\t\t\t}\n\t\t\t\treturn category && !category.disabled && parseInt(category.cid, 10) !== parseInt(ajaxify.data.category.cid, 10) && !isChild;\n\t\t\t});\n\n\t\t\tcategorySelector.modal(categories, function (parentCid) {\n\t\t\t\tapi.put('/categories/' + ajaxify.data.category.cid, {\n\t\t\t\t\tparentCid: parentCid,\n\t\t\t\t}).then(() => {\n\t\t\t\t\tvar parent = allCategories.filter(function (category) {\n\t\t\t\t\t\treturn category && parseInt(category.cid, 10) === parseInt(parentCid, 10);\n\t\t\t\t\t});\n\t\t\t\t\tparent = parent[0];\n\n\t\t\t\t\t$('button[data-action=\"removeParent\"]').parent().removeClass('hide');\n\t\t\t\t\t$('button[data-action=\"setParent\"]').addClass('hide');\n\t\t\t\t\tvar buttonHtml = '<i class=\"fa ' + parent.icon + '\"></i> ' + parent.name;\n\t\t\t\t\t$('button[data-action=\"changeParent\"]').html(buttonHtml).parent().removeClass('hide');\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t};\n\n\treturn Category;\n});\n"]}