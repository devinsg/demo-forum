{"version":3,"sources":["public/src/client/topic/threadTools.js"],"names":["define","components","translator","handleBack","api","ThreadTools","init","tid","topicContainer","renderMenu","on","topicCommand","put","del","socket","emit","err","app","alertError","previousUrl","match","ajaxify","go","onBackClicked","data","category","slug","alertSuccess","btn","$","this","message","parents","find","trigger","require","move","cid","deletePosts","fork","movePosts","changeWatching","type","state","method","setFollowState","alert","alert_id","timeout","window","title","container","$this","dropdownMenu","html","parseAndTranslate","element","command","translate","msg","bootbox","confirm","suffix","undefined","setLockedState","threadEl","get","parseInt","attr","isLocked","privileges","isAdminOrMod","toggleClass","parent","hideReply","deleted","user","uid","locked","setDeleteState","isDelete","deleter","deletedTimestampISO","utils","toISOString","Date","now","replaceWith","timeago","setPinnedState","isPinned","pinned","titles","follow","unfollow","ignore","translatedTitle","tooltip","menu"],"mappings":"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","file":"public/src/client/topic/threadTools.js","sourcesContent":["'use strict';\n\n\ndefine('forum/topic/threadTools', [\n\t'components',\n\t'translator',\n\t'handleBack',\n\t'api',\n], function (components, translator, handleBack, api) {\n\tvar ThreadTools = {};\n\n\tThreadTools.init = function (tid, topicContainer) {\n\t\trenderMenu(topicContainer);\n\n\t\ttopicContainer.on('click', '[component=\"topic/delete\"]', function () {\n\t\t\ttopicCommand('delete', tid);\n\t\t\treturn false;\n\t\t});\n\n\t\ttopicContainer.on('click', '[component=\"topic/restore\"]', function () {\n\t\t\ttopicCommand('restore', tid);\n\t\t\treturn false;\n\t\t});\n\n\t\ttopicContainer.on('click', '[component=\"topic/purge\"]', function () {\n\t\t\ttopicCommand('purge', tid);\n\t\t\treturn false;\n\t\t});\n\n\t\ttopicContainer.on('click', '[component=\"topic/lock\"]', function () {\n\t\t\tapi.put(`/topics/${tid}/lock`);\n\t\t\treturn false;\n\t\t});\n\n\t\ttopicContainer.on('click', '[component=\"topic/unlock\"]', function () {\n\t\t\tapi.del(`/topics/${tid}/lock`);\n\t\t\treturn false;\n\t\t});\n\n\t\ttopicContainer.on('click', '[component=\"topic/pin\"]', function () {\n\t\t\tapi.put(`/topics/${tid}/pin`);\n\t\t\treturn false;\n\t\t});\n\n\t\ttopicContainer.on('click', '[component=\"topic/unpin\"]', function () {\n\t\t\tapi.del(`/topics/${tid}/pin`);\n\t\t\treturn false;\n\t\t});\n\n\t\ttopicContainer.on('click', '[component=\"topic/mark-unread\"]', function () {\n\t\t\tsocket.emit('topics.markUnread', tid, function (err) {\n\t\t\t\tif (err) {\n\t\t\t\t\treturn app.alertError(err);\n\t\t\t\t}\n\n\t\t\t\tif (app.previousUrl && !app.previousUrl.match('^/topic')) {\n\t\t\t\t\tajaxify.go(app.previousUrl, function () {\n\t\t\t\t\t\thandleBack.onBackClicked(true);\n\t\t\t\t\t});\n\t\t\t\t} else if (ajaxify.data.category) {\n\t\t\t\t\tajaxify.go('category/' + ajaxify.data.category.slug, handleBack.onBackClicked);\n\t\t\t\t}\n\n\t\t\t\tapp.alertSuccess('[[topic:mark_unread.success]]');\n\t\t\t});\n\t\t\treturn false;\n\t\t});\n\n\t\ttopicContainer.on('click', '[component=\"topic/mark-unread-for-all\"]', function () {\n\t\t\tvar btn = $(this);\n\t\t\tsocket.emit('topics.markAsUnreadForAll', [tid], function (err) {\n\t\t\t\tif (err) {\n\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t}\n\t\t\t\tapp.alertSuccess('[[topic:markAsUnreadForAll.success]]');\n\t\t\t\tbtn.parents('.thread-tools.open').find('.dropdown-toggle').trigger('click');\n\t\t\t});\n\t\t\treturn false;\n\t\t});\n\n\t\ttopicContainer.on('click', '[component=\"topic/move\"]', function () {\n\t\t\trequire(['forum/topic/move'], function (move) {\n\t\t\t\tmove.init([tid], ajaxify.data.cid);\n\t\t\t});\n\t\t\treturn false;\n\t\t});\n\n\t\ttopicContainer.on('click', '[component=\"topic/delete/posts\"]', function () {\n\t\t\trequire(['forum/topic/delete-posts'], function (deletePosts) {\n\t\t\t\tdeletePosts.init();\n\t\t\t});\n\t\t});\n\n\t\ttopicContainer.on('click', '[component=\"topic/fork\"]', function () {\n\t\t\trequire(['forum/topic/fork'], function (fork) {\n\t\t\t\tfork.init();\n\t\t\t});\n\t\t});\n\n\t\ttopicContainer.on('click', '[component=\"topic/move-posts\"]', function () {\n\t\t\trequire(['forum/topic/move-post'], function (movePosts) {\n\t\t\t\tmovePosts.init();\n\t\t\t});\n\t\t});\n\n\t\ttopicContainer.on('click', '[component=\"topic/following\"]', function () {\n\t\t\tchangeWatching('follow');\n\t\t});\n\t\ttopicContainer.on('click', '[component=\"topic/not-following\"]', function () {\n\t\t\tchangeWatching('follow', 0);\n\t\t});\n\t\ttopicContainer.on('click', '[component=\"topic/ignoring\"]', function () {\n\t\t\tchangeWatching('ignore');\n\t\t});\n\n\t\tfunction changeWatching(type, state = 1) {\n\t\t\tconst method = state ? 'put' : 'del';\n\t\t\tapi[method](`/topics/${tid}/${type}`, {}, () => {\n\t\t\t\tvar message = '';\n\t\t\t\tif (type === 'follow') {\n\t\t\t\t\tmessage = state ? '[[topic:following_topic.message]]' : '[[topic:not_following_topic.message]]';\n\t\t\t\t} else if (type === 'ignore') {\n\t\t\t\t\tmessage = state ? '[[topic:ignoring_topic.message]]' : '[[topic:not_following_topic.message]]';\n\t\t\t\t}\n\n\t\t\t\t// From here on out, type changes to 'unfollow' if state is falsy\n\t\t\t\tif (!state) {\n\t\t\t\t\ttype = 'unfollow';\n\t\t\t\t}\n\n\t\t\t\tsetFollowState(type);\n\n\t\t\t\tapp.alert({\n\t\t\t\t\talert_id: 'follow_thread',\n\t\t\t\t\tmessage: message,\n\t\t\t\t\ttype: 'success',\n\t\t\t\t\ttimeout: 5000,\n\t\t\t\t});\n\n\t\t\t\t$(window).trigger('action:topics.changeWatching', { tid: tid, type: type });\n\t\t\t}, () => {\n\t\t\t\tapp.alert({\n\t\t\t\t\ttype: 'danger',\n\t\t\t\t\talert_id: 'topic_follow',\n\t\t\t\t\ttitle: '[[global:please_log_in]]',\n\t\t\t\t\tmessage: '[[topic:login_to_subscribe]]',\n\t\t\t\t\ttimeout: 5000,\n\t\t\t\t});\n\t\t\t});\n\n\t\t\treturn false;\n\t\t}\n\t};\n\n\tfunction renderMenu(container) {\n\t\tcontainer.on('show.bs.dropdown', '.thread-tools', function () {\n\t\t\tvar $this = $(this);\n\t\t\tvar dropdownMenu = $this.find('.dropdown-menu');\n\t\t\tif (dropdownMenu.html()) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tsocket.emit('topics.loadTopicTools', { tid: ajaxify.data.tid, cid: ajaxify.data.cid }, function (err, data) {\n\t\t\t\tif (err) {\n\t\t\t\t\treturn app.alertError(err);\n\t\t\t\t}\n\t\t\t\tapp.parseAndTranslate('partials/topic/topic-menu-list', data, function (html) {\n\t\t\t\t\tdropdownMenu.html(html);\n\t\t\t\t\t$(window).trigger('action:topic.tools.load', {\n\t\t\t\t\t\telement: dropdownMenu,\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t}\n\n\tfunction topicCommand(command, tid) {\n\t\ttranslator.translate('[[topic:thread_tools.' + command + '_confirm]]', function (msg) {\n\t\t\tbootbox.confirm(msg, function (confirm) {\n\t\t\t\tif (!confirm) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst method = command === 'restore' ? 'put' : 'del';\n\t\t\t\tconst suffix = command !== 'purge' ? '/state' : '';\n\t\t\t\tapi[method](`/topics/${tid}${suffix}`, undefined, undefined, 'default');\n\t\t\t});\n\t\t});\n\t}\n\n\tThreadTools.setLockedState = function (data) {\n\t\tvar threadEl = components.get('topic');\n\t\tif (parseInt(data.tid, 10) !== parseInt(threadEl.attr('data-tid'), 10)) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar isLocked = data.isLocked && !ajaxify.data.privileges.isAdminOrMod;\n\n\t\tcomponents.get('topic/lock').toggleClass('hidden', data.isLocked).parent().attr('hidden', data.isLocked ? '' : null);\n\t\tcomponents.get('topic/unlock').toggleClass('hidden', !data.isLocked).parent().attr('hidden', !data.isLocked ? '' : null);\n\n\t\tvar hideReply = !!((data.isLocked || ajaxify.data.deleted) && !ajaxify.data.privileges.isAdminOrMod);\n\n\t\tcomponents.get('topic/reply/container').toggleClass('hidden', hideReply);\n\t\tcomponents.get('topic/reply/locked').toggleClass('hidden', ajaxify.data.privileges.isAdminOrMod || !data.isLocked || ajaxify.data.deleted);\n\n\t\tthreadEl.find('[component=\"post\"]:not(.deleted) [component=\"post/reply\"], [component=\"post\"]:not(.deleted) [component=\"post/quote\"]').toggleClass('hidden', hideReply);\n\t\tthreadEl.find('[component=\"post/edit\"], [component=\"post/delete\"]').toggleClass('hidden', isLocked);\n\n\t\tthreadEl.find('[component=\"post\"][data-uid=\"' + app.user.uid + '\"].deleted [component=\"post/tools\"]').toggleClass('hidden', isLocked);\n\n\t\t$('.topic-header [component=\"topic/locked\"]').toggleClass('hidden', !data.isLocked);\n\t\t$('[component=\"post/tools\"] .dropdown-menu').html('');\n\t\tajaxify.data.locked = data.isLocked;\n\t};\n\n\tThreadTools.setDeleteState = function (data) {\n\t\tvar threadEl = components.get('topic');\n\t\tif (parseInt(data.tid, 10) !== parseInt(threadEl.attr('data-tid'), 10)) {\n\t\t\treturn;\n\t\t}\n\n\t\tcomponents.get('topic/delete').toggleClass('hidden', data.isDelete).parent().attr('hidden', data.isDelete ? '' : null);\n\t\tcomponents.get('topic/restore').toggleClass('hidden', !data.isDelete).parent().attr('hidden', !data.isDelete ? '' : null);\n\t\tcomponents.get('topic/purge').toggleClass('hidden', !data.isDelete).parent().attr('hidden', !data.isDelete ? '' : null);\n\t\tcomponents.get('topic/deleted/message').toggleClass('hidden', !data.isDelete);\n\n\t\tif (data.isDelete) {\n\t\t\tapp.parseAndTranslate('partials/topic/deleted-message', {\n\t\t\t\tdeleter: data.user,\n\t\t\t\tdeleted: true,\n\t\t\t\tdeletedTimestampISO: utils.toISOString(Date.now()),\n\t\t\t}, function (html) {\n\t\t\t\tcomponents.get('topic/deleted/message').replaceWith(html);\n\t\t\t\thtml.find('.timeago').timeago();\n\t\t\t});\n\t\t}\n\t\tvar hideReply = data.isDelete && !ajaxify.data.privileges.isAdminOrMod;\n\n\t\tcomponents.get('topic/reply/container').toggleClass('hidden', hideReply);\n\t\tcomponents.get('topic/reply/locked').toggleClass('hidden', ajaxify.data.privileges.isAdminOrMod || !ajaxify.data.locked || data.isDelete);\n\t\tthreadEl.find('[component=\"post\"]:not(.deleted) [component=\"post/reply\"], [component=\"post\"]:not(.deleted) [component=\"post/quote\"]').toggleClass('hidden', hideReply);\n\n\t\tthreadEl.toggleClass('deleted', data.isDelete);\n\t\tajaxify.data.deleted = data.isDelete ? 1 : 0;\n\t};\n\n\n\tThreadTools.setPinnedState = function (data) {\n\t\tvar threadEl = components.get('topic');\n\t\tif (parseInt(data.tid, 10) !== parseInt(threadEl.attr('data-tid'), 10)) {\n\t\t\treturn;\n\t\t}\n\n\t\tcomponents.get('topic/pin').toggleClass('hidden', data.isPinned).parent().attr('hidden', data.isPinned ? '' : null);\n\t\tcomponents.get('topic/unpin').toggleClass('hidden', !data.isPinned).parent().attr('hidden', !data.isPinned ? '' : null);\n\t\t$('.topic-header [component=\"topic/pinned\"]').toggleClass('hidden', !data.isPinned);\n\t\tajaxify.data.pinned = data.isPinned;\n\t};\n\n\tfunction setFollowState(state) {\n\t\tvar titles = {\n\t\t\tfollow: '[[topic:watching]]',\n\t\t\tunfollow: '[[topic:not-watching]]',\n\t\t\tignore: '[[topic:ignoring]]',\n\t\t};\n\t\ttranslator.translate(titles[state], function (translatedTitle) {\n\t\t\t$('[component=\"topic/watch\"] button')\n\t\t\t\t.attr('title', translatedTitle)\n\t\t\t\t.tooltip('fixTitle');\n\t\t});\n\n\t\tvar menu = components.get('topic/following/menu');\n\t\tmenu.toggleClass('hidden', state !== 'follow');\n\t\tcomponents.get('topic/following/check').toggleClass('fa-check', state === 'follow');\n\n\t\tmenu = components.get('topic/not-following/menu');\n\t\tmenu.toggleClass('hidden', state !== 'unfollow');\n\t\tcomponents.get('topic/not-following/check').toggleClass('fa-check', state === 'unfollow');\n\n\t\tmenu = components.get('topic/ignoring/menu');\n\t\tmenu.toggleClass('hidden', state !== 'ignore');\n\t\tcomponents.get('topic/ignoring/check').toggleClass('fa-check', state === 'ignore');\n\t}\n\n\n\treturn ThreadTools;\n});\n"]}