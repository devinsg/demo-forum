{"version":3,"sources":["public/src/client/topic/move-post.js"],"names":["define","components","postSelect","translator","alerts","MovePost","moveModal","moveCommit","fromTid","init","postEl","ajaxify","data","tid","app","parseAndTranslate","html","find","$","append","on","closeMoveModal","onPostToggled","showPostsSelected","togglePostSelection","attr","window","off","checkMoveButtonEnable","alert","alert_id","pids","join","title","message","type","timeout","timeoutfn","movePosts","clickfn","params","alertSuccess","removeAttr","length","template","topic","translateStr","compile","translateHtml","socket","emit","err","alertError","forEach","pid","get","fadeOut","this","remove","disable"],"mappings":"AAAA,aAGAA,OAAO,yBACN,aAAc,aAAc,aAAc,UACxC,SAAUC,EAAYC,EAAYC,EAAYC,GAChD,IAAIC,KAEJ,IAAIC,EACJ,IAAIC,EACJ,IAAIC,EAEJH,EAASI,KAAO,SAAUC,GACzB,GAAIJ,EAAW,CACd,OAEDE,EAAUG,QAAQC,KAAKC,IACvBC,IAAIC,kBAAkB,sBAAwB,SAAUC,GACvDV,EAAYU,EAEZT,EAAaD,EAAUW,KAAK,uBAE5BC,EAAE,QAAQC,OAAOb,GAEjBA,EAAUW,KAAK,6BAA6BG,GAAG,QAASC,GACxDnB,EAAWO,KAAKa,GAChBC,IAEA,GAAIb,EAAQ,CACXR,EAAWsB,oBAAoBd,EAAQA,EAAOe,KAAK,aAGpDP,EAAEQ,QAAQC,IAAI,qBAAsBC,GAClCR,GAAG,qBAAsBQ,GAE3BrB,EAAWa,GAAG,QAAS,WACtBb,EAAWkB,KAAK,WAAY,MAE5BrB,EAAOyB,OACNC,SAAU,aAAe5B,EAAW6B,KAAKC,KAAK,KAC9CC,MAAO,oCACPC,QAAS,qCACTC,KAAM,UACNC,QAAS,IACTC,UAAW,WACVC,KAEDC,QAAS,SAAUV,EAAOW,UAClBA,EAAOH,UACdvB,IAAI2B,aAAa,qCACjBlC,EAAWmC,WAAW,oBAO3B,SAASnB,IACR,IAAKjB,EAAW,CACf,OAED,GAAIJ,EAAW6B,KAAKY,OAAQ,CAC3B,GAAIhC,QAAQC,KAAKgC,SAASC,OAASlC,QAAQC,KAAKC,KAAOF,QAAQC,KAAKC,MAAQL,EAAS,CACpF,IAAIsC,EAAe3C,EAAW4C,QAAQ,mCAAoC7C,EAAW6B,KAAKY,OAAQhC,QAAQC,KAAKqB,OAC/G3B,EAAUW,KAAK,SAAS+B,cAAcF,OAChC,CACNxC,EAAUW,KAAK,SAAS+B,cAAc,6BAA+B9C,EAAW6B,KAAKY,OAAS,WAEzF,CACNrC,EAAUW,KAAK,SAAS+B,cAAc,gCAIxC,SAASpB,IACR,IAAKtB,EAAW,CACf,OAGD,GAAIJ,EAAW6B,KAAKY,QAAUhC,QAAQC,KAAKC,KAC1CF,QAAQC,KAAKgC,SAASC,OAASlC,QAAQC,KAAKC,MAAQL,EACnD,CACDD,EAAWmC,WAAW,gBAChB,CACNnC,EAAWkB,KAAK,WAAY,MAE7BF,IAGD,SAASD,IACRM,IAGD,SAASU,IACR,IAAK3B,QAAQC,KAAKgC,SAASC,QAAUlC,QAAQC,KAAKC,IAAK,CACtD,OAEDoC,OAAOC,KAAK,mBAAqBnB,KAAM7B,EAAW6B,KAAMlB,IAAKF,QAAQC,KAAKC,KAAO,SAAUsC,GAC1F,GAAIA,EAAK,CACR,OAAOrC,IAAIsC,WAAWD,EAAIjB,SAE3BhC,EAAW6B,KAAKsB,QAAQ,SAAUC,GACjCrD,EAAWsD,IAAI,OAAQ,MAAOD,GAAKE,QAAQ,IAAK,WAC/CtC,EAAEuC,MAAMC,aAIVrC,MAIF,SAASA,IACR,GAAIf,EAAW,CACdA,EAAUoD,SACVpD,EAAY,KACZJ,EAAWyD,WAKb,OAAOtD","file":"public/src/client/topic/move-post.js","sourcesContent":["'use strict';\n\n\ndefine('forum/topic/move-post', [\n\t'components', 'postSelect', 'translator', 'alerts',\n], function (components, postSelect, translator, alerts) {\n\tvar MovePost = {};\n\n\tvar moveModal;\n\tvar moveCommit;\n\tvar fromTid;\n\n\tMovePost.init = function (postEl) {\n\t\tif (moveModal) {\n\t\t\treturn;\n\t\t}\n\t\tfromTid = ajaxify.data.tid;\n\t\tapp.parseAndTranslate('modals/move-post', {}, function (html) {\n\t\t\tmoveModal = html;\n\n\t\t\tmoveCommit = moveModal.find('#move_posts_confirm');\n\n\t\t\t$('body').append(moveModal);\n\n\t\t\tmoveModal.find('.close,#move_posts_cancel').on('click', closeMoveModal);\n\t\t\tpostSelect.init(onPostToggled);\n\t\t\tshowPostsSelected();\n\n\t\t\tif (postEl) {\n\t\t\t\tpostSelect.togglePostSelection(postEl, postEl.attr('data-pid'));\n\t\t\t}\n\n\t\t\t$(window).off('action:axajify.end', checkMoveButtonEnable)\n\t\t\t\t.on('action:ajaxify.end', checkMoveButtonEnable);\n\n\t\t\tmoveCommit.on('click', function () {\n\t\t\t\tmoveCommit.attr('disabled', true);\n\n\t\t\t\talerts.alert({\n\t\t\t\t\talert_id: 'pids_move_' + postSelect.pids.join('-'),\n\t\t\t\t\ttitle: '[[topic:thread_tools.move-posts]]',\n\t\t\t\t\tmessage: '[[topic:topic_move_posts_success]]',\n\t\t\t\t\ttype: 'success',\n\t\t\t\t\ttimeout: 10000,\n\t\t\t\t\ttimeoutfn: function () {\n\t\t\t\t\t\tmovePosts();\n\t\t\t\t\t},\n\t\t\t\t\tclickfn: function (alert, params) {\n\t\t\t\t\t\tdelete params.timeoutfn;\n\t\t\t\t\t\tapp.alertSuccess('[[topic:topic_move_posts_undone]]');\n\t\t\t\t\t\tmoveCommit.removeAttr('disabled');\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t};\n\n\tfunction showPostsSelected() {\n\t\tif (!moveModal) {\n\t\t\treturn;\n\t\t}\n\t\tif (postSelect.pids.length) {\n\t\t\tif (ajaxify.data.template.topic && ajaxify.data.tid && ajaxify.data.tid !== fromTid) {\n\t\t\t\tvar translateStr = translator.compile('topic:x-posts-will-be-moved-to-y', postSelect.pids.length, ajaxify.data.title);\n\t\t\t\tmoveModal.find('#pids').translateHtml(translateStr);\n\t\t\t} else {\n\t\t\t\tmoveModal.find('#pids').translateHtml('[[topic:x-posts-selected, ' + postSelect.pids.length + ']]');\n\t\t\t}\n\t\t} else {\n\t\t\tmoveModal.find('#pids').translateHtml('[[topic:no-posts-selected]]');\n\t\t}\n\t}\n\n\tfunction checkMoveButtonEnable() {\n\t\tif (!moveModal) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (postSelect.pids.length && ajaxify.data.tid &&\n\t\t\tajaxify.data.template.topic && ajaxify.data.tid !== fromTid\n\t\t) {\n\t\t\tmoveCommit.removeAttr('disabled');\n\t\t} else {\n\t\t\tmoveCommit.attr('disabled', true);\n\t\t}\n\t\tshowPostsSelected();\n\t}\n\n\tfunction onPostToggled() {\n\t\tcheckMoveButtonEnable();\n\t}\n\n\tfunction movePosts() {\n\t\tif (!ajaxify.data.template.topic || !ajaxify.data.tid) {\n\t\t\treturn;\n\t\t}\n\t\tsocket.emit('posts.movePosts', { pids: postSelect.pids, tid: ajaxify.data.tid }, function (err) {\n\t\t\tif (err) {\n\t\t\t\treturn app.alertError(err.message);\n\t\t\t}\n\t\t\tpostSelect.pids.forEach(function (pid) {\n\t\t\t\tcomponents.get('post', 'pid', pid).fadeOut(500, function () {\n\t\t\t\t\t$(this).remove();\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tcloseMoveModal();\n\t\t});\n\t}\n\n\tfunction closeMoveModal() {\n\t\tif (moveModal) {\n\t\t\tmoveModal.remove();\n\t\t\tmoveModal = null;\n\t\t\tpostSelect.disable();\n\t\t}\n\t}\n\n\n\treturn MovePost;\n});\n"]}