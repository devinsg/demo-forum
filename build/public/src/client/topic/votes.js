"use strict";define("forum/topic/votes",["components","translator","benchpress","api"],function(t,o,e,n){var r={};r.addVoteHandler=function(){t.get("topic").on("mouseenter",'[data-pid] [component="post/vote-count"]',a);t.get("topic").on("mouseout",'[data-pid] [component="post/vote-count"]',function(){var t=$(this).parent();t.on("shown.bs.tooltip",function(){$(".tooltip").tooltip("destroy");t.off("shown.bs.tooltip")});$(".tooltip").tooltip("destroy")})};function a(t){t.stopPropagation();var o=$(this);var e=o.parent();var n=e.parents("[data-pid]").attr("data-pid");$(".tooltip").tooltip("destroy");o.off("mouseenter",a);socket.emit("posts.getUpvoters",[n],function(t,n){if(t){return app.alertError(t.message)}if(n.length){s(e,n[0])}o.off("mouseenter").on("mouseenter",a)});return false}function s(t,e){function n(o){t.attr("title",o).tooltip("fixTitle").tooltip("show")}var r=e.usernames;if(!r.length){return}if(r.length+e.otherCount>6){r=r.join(", ").replace(/,/g,"|");o.translate("[[topic:users_and_others, "+r+", "+e.otherCount+"]]",function(t){t=t.replace(/\|/g,",");n(t)})}else{r=r.join(", ");n(r)}}r.toggleVote=function(t,o,e){var r=t.closest("[data-pid]");var a=r.find(o).length;const s=a?"del":"put";n[s](`/posts/${r.attr("data-pid")}/vote`,{delta:e},undefined,t=>{app.alertError(t.status.message);if(t.status.message==="[[error:not-logged-in]]"){ajaxify.go("login")}});return false};r.showVotes=function(t){socket.emit("posts.getVoters",{pid:t,cid:ajaxify.data.cid},function(t,n){if(t){if(t.message==="[[error:no-privileges]]"){return}return app.alertError(t.message)}e.parse("partials/modals/votes_modal",n,function(t){o.translate(t,function(t){var o=bootbox.dialog({title:"[[global:voters]]",message:t,className:"vote-modal",show:true});o.on("click",function(){o.modal("hide")})})})})};return r});
//# sourceMappingURL=votes.js.map