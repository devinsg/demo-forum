{"version":3,"sources":["public/src/client/topic/move.js"],"names":["define","categorySelector","alerts","Move","modal","selectedCategory","init","tids","currentCid","onComplete","moveAll","socket","emit","onCategoriesLoaded","err","categories","app","alertError","message","parseModal","on","remove","find","addClass","length","translateText","onCategorySelected","onCommitClicked","callback","parseAndTranslate","html","$","category","prop","commitEl","cid","alert","alert_id","join","title","name","type","timeout","timeoutfn","moveTopics","clickfn","params","alertSuccess","data","window","trigger"],"mappings":"AAAA,aAGAA,OAAO,oBAAqB,mBAAoB,UAAW,SAAUC,EAAkBC,GACtF,IAAIC,KACJ,IAAIC,EACJ,IAAIC,EAEJF,EAAKG,KAAO,SAAUC,EAAMC,EAAYC,GACvCN,EAAKI,KAAOA,EACZJ,EAAKK,WAAaA,EAClBL,EAAKM,WAAaA,EAClBN,EAAKO,SAAWH,EAEhBI,OAAOC,KAAK,+BAAgCC,IAG7C,SAASA,EAAmBC,EAAKC,GAChC,GAAID,EAAK,CACR,OAAOE,IAAIC,WAAWH,EAAII,SAG3BC,EAAWJ,EAAY,WACtBX,EAAMgB,GAAG,kBAAmB,WAC3BhB,EAAMiB,WAGPjB,EAAMkB,KAAK,iBAAiBC,SAAS,QAErC,GAAIpB,EAAKO,SAAYP,EAAKI,MAAQJ,EAAKI,KAAKiB,OAAS,EAAI,CACxDpB,EAAMkB,KAAK,oBAAoBG,cAAc,yBAG9CxB,EAAiBK,KAAKF,EAAMkB,KAAK,mCAAoCI,GAErEtB,EAAMkB,KAAK,uBAAuBF,GAAG,QAASO,GAE9CvB,EAAMA,MAAM,UAId,SAASe,EAAWJ,EAAYa,GAC/BZ,IAAIa,kBAAkB,8BAAgCd,WAAYA,GAAc,SAAUe,GACzF1B,EAAQ2B,EAAED,GAEVF,MAIF,SAASF,EAAmBM,GAC3B3B,EAAmB2B,EACnB5B,EAAMkB,KAAK,uBAAuBW,KAAK,WAAY,OAGpD,SAASN,IACR,IAAIO,EAAW9B,EAAMkB,KAAK,uBAE1B,IAAKY,EAASD,KAAK,aAAe5B,GAAoBA,EAAiB8B,IAAK,CAC3ED,EAASD,KAAK,WAAY,MAE1B7B,EAAMA,MAAM,QAEZF,EAAOkC,OACNC,SAAU,aAAelC,EAAKI,KAAK+B,KAAK,KACxCC,MAAO,8BACPrB,QAAS,+BAAiCb,EAAiBmC,KAAO,KAClEC,KAAM,UACNC,QAAS,IACTC,UAAW,WACVC,KAEDC,QAAS,SAAUT,EAAOU,UAClBA,EAAOH,UACd3B,IAAI+B,aAAa,mCAMrB,SAASH,IACR,IAAII,GACHzC,KAAMJ,EAAKI,KACX4B,IAAK9B,EAAiB8B,IACtB3B,WAAYL,EAAKK,YAGlBuB,EAAEkB,QAAQC,QAAQ,oBAAqBF,GAEvCrC,OAAOC,KAAKT,EAAKO,QAAU,iBAAmB,cAAesC,EAAM,SAAUlC,GAC5E,GAAIA,EAAK,CACR,OAAOE,IAAIC,WAAWH,EAAII,SAG3B,UAAWf,EAAKM,aAAe,WAAY,CAC1CN,EAAKM,gBAMR,OAAON","file":"public/src/client/topic/move.js","sourcesContent":["'use strict';\n\n\ndefine('forum/topic/move', ['categorySelector', 'alerts'], function (categorySelector, alerts) {\n\tvar Move = {};\n\tvar modal;\n\tvar selectedCategory;\n\n\tMove.init = function (tids, currentCid, onComplete) {\n\t\tMove.tids = tids;\n\t\tMove.currentCid = currentCid;\n\t\tMove.onComplete = onComplete;\n\t\tMove.moveAll = !tids;\n\n\t\tsocket.emit('categories.getMoveCategories', onCategoriesLoaded);\n\t};\n\n\tfunction onCategoriesLoaded(err, categories) {\n\t\tif (err) {\n\t\t\treturn app.alertError(err.message);\n\t\t}\n\n\t\tparseModal(categories, function () {\n\t\t\tmodal.on('hidden.bs.modal', function () {\n\t\t\t\tmodal.remove();\n\t\t\t});\n\n\t\t\tmodal.find('#move-confirm').addClass('hide');\n\n\t\t\tif (Move.moveAll || (Move.tids && Move.tids.length > 1)) {\n\t\t\t\tmodal.find('.modal-header h3').translateText('[[topic:move_topics]]');\n\t\t\t}\n\n\t\t\tcategorySelector.init(modal.find('[component=\"category-selector\"]'), onCategorySelected);\n\n\t\t\tmodal.find('#move_thread_commit').on('click', onCommitClicked);\n\n\t\t\tmodal.modal('show');\n\t\t});\n\t}\n\n\tfunction parseModal(categories, callback) {\n\t\tapp.parseAndTranslate('partials/move_thread_modal', { categories: categories }, function (html) {\n\t\t\tmodal = $(html);\n\n\t\t\tcallback();\n\t\t});\n\t}\n\n\tfunction onCategorySelected(category) {\n\t\tselectedCategory = category;\n\t\tmodal.find('#move_thread_commit').prop('disabled', false);\n\t}\n\n\tfunction onCommitClicked() {\n\t\tvar commitEl = modal.find('#move_thread_commit');\n\n\t\tif (!commitEl.prop('disabled') && selectedCategory && selectedCategory.cid) {\n\t\t\tcommitEl.prop('disabled', true);\n\n\t\t\tmodal.modal('hide');\n\n\t\t\talerts.alert({\n\t\t\t\talert_id: 'tids_move_' + Move.tids.join('-'),\n\t\t\t\ttitle: '[[topic:thread_tools.move]]',\n\t\t\t\tmessage: '[[topic:topic_move_success, ' + selectedCategory.name + ']]',\n\t\t\t\ttype: 'success',\n\t\t\t\ttimeout: 10000,\n\t\t\t\ttimeoutfn: function () {\n\t\t\t\t\tmoveTopics();\n\t\t\t\t},\n\t\t\t\tclickfn: function (alert, params) {\n\t\t\t\t\tdelete params.timeoutfn;\n\t\t\t\t\tapp.alertSuccess('[[topic:topic_move_undone]]');\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t}\n\n\tfunction moveTopics() {\n\t\tvar data = {\n\t\t\ttids: Move.tids,\n\t\t\tcid: selectedCategory.cid,\n\t\t\tcurrentCid: Move.currentCid,\n\t\t};\n\n\t\t$(window).trigger('action:topic.move', data);\n\n\t\tsocket.emit(Move.moveAll ? 'topics.moveAll' : 'topics.move', data, function (err) {\n\t\t\tif (err) {\n\t\t\t\treturn app.alertError(err.message);\n\t\t\t}\n\n\t\t\tif (typeof Move.onComplete === 'function') {\n\t\t\t\tMove.onComplete();\n\t\t\t}\n\t\t});\n\t}\n\n\n\treturn Move;\n});\n"]}