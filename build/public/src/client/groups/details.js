"use strict";define("forum/groups/details",["forum/groups/memberlist","iconSelect","components","coverPhoto","pictureCropper","translator","api","slugify"],function(e,a,t,r,i,o,n,s){var u={};var c;u.init=function(){var a=t.get("groups/container");c=ajaxify.data.group.name;if(ajaxify.data.group.isOwner){u.prepareSettings();r.init(t.get("groups/cover"),function(e,a,t){socket.emit("groups.cover.update",{groupName:c,imageData:e,position:a},t)},function(){i.show({title:"[[groups:upload-group-cover]]",socketMethod:"groups.cover.update",aspectRatio:NaN,allowSkippingCrop:true,restrictImageDimension:false,paramName:"groupName",paramValue:c},function(e){e=(!e.startsWith("http")?config.relative_path:"")+e+"?"+Date.now();t.get("groups/cover").css("background-image","url("+e+")")})},f)}e.init();p();t.get("groups/activity").find(".content img:not(.not-responsive)").addClass("img-responsive");a.on("click","[data-action]",function(){var e=$(this);var a=e.parents("[data-uid]");var t=a.find(".member-name > i");var r=!t.hasClass("invisible");var i=a.attr("data-uid");var s=e.attr("data-action");switch(s){case"toggleOwnership":socket.emit("groups."+(r?"rescind":"grant"),{toUid:i,groupName:c},function(e){if(!e){t.toggleClass("invisible")}else{app.alertError(e.message)}});break;case"kick":o.translate("[[groups:details.kick_confirm]]",function(e){bootbox.confirm(e,function(e){if(!e){return}socket.emit("groups.kick",{uid:i,groupName:c},function(e){if(!e){a.slideUp().remove()}else{app.alertError(e.message)}})})});break;case"update":u.update();break;case"delete":u.deleteGroup();break;case"join":n.put("/groups/"+ajaxify.data.group.slug+"/membership/"+(i||app.user.uid),undefined).then(()=>ajaxify.refresh());break;case"leave":n.del("/groups/"+ajaxify.data.group.slug+"/membership/"+(i||app.user.uid),undefined).then(()=>ajaxify.refresh());break;case"accept":case"reject":case"issueInvite":case"rescindInvite":case"acceptInvite":case"rejectInvite":case"acceptAll":case"rejectAll":socket.emit("groups."+s,{toUid:i,groupName:c},function(e){if(!e){ajaxify.refresh()}else{app.alertError(e.message)}});break}})};u.prepareSettings=function(){var e=t.get("groups/settings");var r=e.find('[name="labelColor"]');var i=e.find('[name="textColor"]');var o=e.find('[data-action="icon-select"]');var n=e.find(".label");var s=n.find("i");var u=e.find('[name="userTitle"]');var c=e.find('[name="userTitleEnabled"]');var p=e.find('[name="icon"]');r.on("input",function(){n.css("background-color",r.val())});i.on("input",function(){n.css("color",i.val())});o.on("click",function(){a.init(s,function(){p.val(s.val())})});u.on("keyup",function(){var a=s.detach();n.text(" "+(this.value||e.find("#name").val()));n.prepend(a)});c.on("change",function(){var e=t.get("groups/userTitleOption");if(this.checked){e.removeAttr("disabled");n.removeClass("hide")}else{e.attr("disabled","disabled");n.addClass("hide")}})};u.update=function(){var e=t.get("groups/settings");var a=e.find('input[type="checkbox"][name]');if(e.length){var r=e.serializeObject();a.each(function(e,a){a=$(a);if(a.length){r[a.attr("name")]=a.prop("checked")}});socket.emit("groups.update",{groupName:c,values:r},function(e){if(e){return app.alertError(e.message)}if(r.name){var a=window.location.pathname;a=a.substr(1,a.lastIndexOf("/"));ajaxify.go(a+s(r.name))}else{ajaxify.refresh()}app.alertSuccess("[[groups:event.updated]]")})}};u.deleteGroup=function(){bootbox.confirm("Are you sure you want to delete the group: "+utils.escapeHTML(c),function(e){if(e){bootbox.prompt("Please enter the name of this group in order to delete it:",function(e){if(e===c){socket.emit("groups.delete",{groupName:c},function(e){if(!e){app.alertSuccess("[[groups:event.deleted, "+utils.escapeHTML(c)+"]]");ajaxify.go("groups")}else{app.alertError(e.message)}})}})}})};function p(){if(!ajaxify.data.group.isOwner){return}var e=$('[component="groups/members/invite"]');require(["autocomplete"],function(a){a.user(e,function(e,a){socket.emit("groups.issueInvite",{toUid:a.item.user.uid,groupName:ajaxify.data.group.name},function(e){if(e){return app.alertError(e.message)}ajaxify.refresh()})})});$('[component="groups/members/bulk-invite-button"]').on("click",function(){var e=$('[component="groups/members/bulk-invite"]').val();if(!e){return false}socket.emit("groups.issueMassInvite",{usernames:e,groupName:ajaxify.data.group.name},function(e){if(e){return app.alertError(e.message)}ajaxify.refresh()});return false})}function f(){o.translate("[[groups:remove_group_cover_confirm]]",function(e){bootbox.confirm(e,function(e){if(!e){return}socket.emit("groups.cover.remove",{groupName:ajaxify.data.group.name},function(e){if(!e){ajaxify.refresh()}else{app.alertError(e.message)}})})})}return u});
//# sourceMappingURL=details.js.map