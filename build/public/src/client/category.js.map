{"version":3,"sources":["public/src/client/category.js"],"names":["define","infinitescroll","share","navigator","topicList","sort","Category","$","window","on","ev","data","String","url","startsWith","disable","init","cid","ajaxify","app","enterRoom","addShareHandlers","name","loadTopicsAfter","handleSort","slug","config","usePagination","topic_count","toTop","toBottom","navigatorCallback","handleScrollToTopicIndex","handleIgnoreWatch","trigger","topics","topicIndex","utils","isNumber","Math","max","parseInt","location","search","indexOf","scrollToElement","$this","this","state","attr","socket","emit","err","alertError","message","toggleClass","alertSuccess","scrollTop","count","scrollBottom","topIndex","bottomIndex","after","direction","callback","params","loadMore","query","categoryTopicSort","done"],"mappings":"AAAA,aAEAA,OAAO,kBACN,uBACA,QACA,YACA,YACA,QACE,SAAUC,EAAgBC,EAAOC,EAAWC,EAAWC,GACzD,IAAIC,KAEJC,EAAEC,QAAQC,GAAG,uBAAwB,SAAUC,EAAIC,GAClD,IAAKC,OAAOD,EAAKE,KAAKC,WAAW,aAAc,CAC9CX,EAAUY,aAIZT,EAASU,KAAO,WACf,IAAIC,EAAMC,QAAQP,KAAKM,IAEvBE,IAAIC,UAAU,YAAcH,GAE5Bf,EAAMmB,iBAAiBH,QAAQP,KAAKW,MAEpClB,EAAUY,KAAK,WAAYO,GAE3BlB,EAAKmB,WAAW,oBAAqB,uBAAwB,YAAcN,QAAQP,KAAKc,MAExF,IAAKC,OAAOC,cAAe,CAC1BxB,EAAUa,KAAK,+BAAgCE,QAAQP,KAAKiB,YAAatB,EAASuB,MAAOvB,EAASwB,SAAUxB,EAASyB,uBAC/G,CACN5B,EAAUY,UAGXiB,IAEAC,EAAkBhB,GAElBV,EAAEC,QAAQ0B,QAAQ,wBAA0BC,OAAQjB,QAAQP,KAAKwB,SACjE5B,EAAEC,QAAQ0B,QAAQ,0BAA4BjB,IAAKC,QAAQP,KAAKM,OAGjE,SAASe,IACR,IAAII,EAAalB,QAAQP,KAAKyB,WAC9B,GAAIA,GAAcC,MAAMC,SAASF,GAAa,CAC7CA,EAAaG,KAAKC,IAAI,EAAGC,SAASL,EAAY,KAC9C,GAAIA,GAAc5B,OAAOkC,SAASC,OAAOC,QAAQ,YAAc,EAAG,CACjEzC,EAAU0C,gBAAgBtC,EAAE,4CAA8C6B,EAAa,MAAO,KAAM,KAKvG,SAASH,EAAkBhB,GAC1BV,EAAE,wGAAwGE,GAAG,QAAS,WACrH,IAAIqC,EAAQvC,EAAEwC,MACd,IAAIC,EAAQF,EAAMG,KAAK,cAEvBC,OAAOC,KAAK,4BAA8BlC,IAAKA,EAAK+B,MAAOA,GAAS,SAAUI,GAC7E,GAAIA,EAAK,CACR,OAAOjC,IAAIkC,WAAWD,EAAIE,SAG3B/C,EAAE,wCAAwCgD,YAAY,SAAUP,IAAU,YAC1EzC,EAAE,yCAAyCgD,YAAY,WAAYP,IAAU,YAE7EzC,EAAE,2CAA2CgD,YAAY,SAAUP,IAAU,eAC7EzC,EAAE,4CAA4CgD,YAAY,WAAYP,IAAU,eAEhFzC,EAAE,wCAAwCgD,YAAY,SAAUP,IAAU,YAC1EzC,EAAE,yCAAyCgD,YAAY,WAAYP,IAAU,YAE7E7B,IAAIqC,aAAa,cAAgBR,EAAQ,kBAK5C1C,EAASuB,MAAQ,WAChB1B,EAAUsD,UAAU,IAGrBnD,EAASwB,SAAW,WACnBoB,OAAOC,KAAK,2BAA4BjC,QAAQP,KAAKM,IAAK,SAAUmC,EAAKM,GACxE,GAAIN,EAAK,CACR,OAAOjC,IAAIkC,WAAWD,EAAIE,SAG3BnD,EAAUwD,aAAaD,EAAQ,MAIjCpD,EAASyB,kBAAoB,SAAU6B,EAAUC,GAChD,OAAOA,GAGR,SAAStC,EAAgBuC,EAAOC,EAAWC,GAC1CA,EAAWA,GAAY,aAEvBzD,EAAEC,QAAQ0B,QAAQ,2BAClB,IAAI+B,EAAS5B,MAAM4B,SACnBhE,EAAeiE,SAAS,uBACvBjD,IAAKC,QAAQP,KAAKM,IAClB6C,MAAOA,EACPC,UAAWA,EACXI,MAAOF,EACPG,kBAAmB1C,OAAO0C,mBACxB,SAAUzD,EAAM0D,GAClB9D,EAAEC,QAAQ0B,QAAQ,0BAClB8B,EAASrD,EAAM0D,KAIjB,OAAO/D","file":"public/src/client/category.js","sourcesContent":["'use strict';\n\ndefine('forum/category', [\n\t'forum/infinitescroll',\n\t'share',\n\t'navigator',\n\t'topicList',\n\t'sort',\n], function (infinitescroll, share, navigator, topicList, sort) {\n\tvar Category = {};\n\n\t$(window).on('action:ajaxify.start', function (ev, data) {\n\t\tif (!String(data.url).startsWith('category/')) {\n\t\t\tnavigator.disable();\n\t\t}\n\t});\n\n\tCategory.init = function () {\n\t\tvar\tcid = ajaxify.data.cid;\n\n\t\tapp.enterRoom('category_' + cid);\n\n\t\tshare.addShareHandlers(ajaxify.data.name);\n\n\t\ttopicList.init('category', loadTopicsAfter);\n\n\t\tsort.handleSort('categoryTopicSort', 'user.setCategorySort', 'category/' + ajaxify.data.slug);\n\n\t\tif (!config.usePagination) {\n\t\t\tnavigator.init('[component=\"category/topic\"]', ajaxify.data.topic_count, Category.toTop, Category.toBottom, Category.navigatorCallback);\n\t\t} else {\n\t\t\tnavigator.disable();\n\t\t}\n\n\t\thandleScrollToTopicIndex();\n\n\t\thandleIgnoreWatch(cid);\n\n\t\t$(window).trigger('action:topics.loaded', { topics: ajaxify.data.topics });\n\t\t$(window).trigger('action:category.loaded', { cid: ajaxify.data.cid });\n\t};\n\n\tfunction handleScrollToTopicIndex() {\n\t\tvar topicIndex = ajaxify.data.topicIndex;\n\t\tif (topicIndex && utils.isNumber(topicIndex)) {\n\t\t\ttopicIndex = Math.max(0, parseInt(topicIndex, 10));\n\t\t\tif (topicIndex && window.location.search.indexOf('page=') === -1) {\n\t\t\t\tnavigator.scrollToElement($('[component=\"category/topic\"][data-index=\"' + topicIndex + '\"]'), true, 0);\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction handleIgnoreWatch(cid) {\n\t\t$('[component=\"category/watching\"], [component=\"category/ignoring\"], [component=\"category/notwatching\"]').on('click', function () {\n\t\t\tvar $this = $(this);\n\t\t\tvar state = $this.attr('data-state');\n\n\t\t\tsocket.emit('categories.setWatchState', { cid: cid, state: state }, function (err) {\n\t\t\t\tif (err) {\n\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t}\n\n\t\t\t\t$('[component=\"category/watching/menu\"]').toggleClass('hidden', state !== 'watching');\n\t\t\t\t$('[component=\"category/watching/check\"]').toggleClass('fa-check', state === 'watching');\n\n\t\t\t\t$('[component=\"category/notwatching/menu\"]').toggleClass('hidden', state !== 'notwatching');\n\t\t\t\t$('[component=\"category/notwatching/check\"]').toggleClass('fa-check', state === 'notwatching');\n\n\t\t\t\t$('[component=\"category/ignoring/menu\"]').toggleClass('hidden', state !== 'ignoring');\n\t\t\t\t$('[component=\"category/ignoring/check\"]').toggleClass('fa-check', state === 'ignoring');\n\n\t\t\t\tapp.alertSuccess('[[category:' + state + '.message]]');\n\t\t\t});\n\t\t});\n\t}\n\n\tCategory.toTop = function () {\n\t\tnavigator.scrollTop(0);\n\t};\n\n\tCategory.toBottom = function () {\n\t\tsocket.emit('categories.getTopicCount', ajaxify.data.cid, function (err, count) {\n\t\t\tif (err) {\n\t\t\t\treturn app.alertError(err.message);\n\t\t\t}\n\n\t\t\tnavigator.scrollBottom(count - 1);\n\t\t});\n\t};\n\n\tCategory.navigatorCallback = function (topIndex, bottomIndex) {\n\t\treturn bottomIndex;\n\t};\n\n\tfunction loadTopicsAfter(after, direction, callback) {\n\t\tcallback = callback || function () {};\n\n\t\t$(window).trigger('action:category.loading');\n\t\tvar params = utils.params();\n\t\tinfinitescroll.loadMore('categories.loadMore', {\n\t\t\tcid: ajaxify.data.cid,\n\t\t\tafter: after,\n\t\t\tdirection: direction,\n\t\t\tquery: params,\n\t\t\tcategoryTopicSort: config.categoryTopicSort,\n\t\t}, function (data, done) {\n\t\t\t$(window).trigger('action:category.loaded');\n\t\t\tcallback(data, done);\n\t\t});\n\t}\n\n\treturn Category;\n});\n"]}