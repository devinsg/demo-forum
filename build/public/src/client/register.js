"use strict";define("forum/register",["translator","zxcvbn","slugify","jquery-form"],function(e,r,a){var s={};var n=false;var i="";s.init=function(){var r=$("#email");var s=$("#username");var i=$("#password");var u=$("#password-confirm");var m=$("#register");c();$("#referrer").val(app.previousUrl);$("#content #noscript").val("false");r.on("blur",function(){if(r.val().length){t(r.val())}});var d=utils.params();if(d.email&&d.token){r.val(decodeURIComponent(d.email));$("#token").val(d.token)}s.on("keyup",function(){$("#yourUsername").text(this.value.length>0?a(this.value):"username")});s.on("blur",function(){if(s.val().length){o(s.val())}});i.on("blur",function(){if(i.val().length){l(i.val(),u.val())}});u.on("blur",function(){if(u.val().length){f(i.val(),u.val())}});function v(e){n=false;l(i.val(),u.val());f(i.val(),u.val());t(r.val(),function(){o(s.val(),e)})}m.on("click",function(r){var a=$(this);var s=$("#register-error-notify");s.addClass("hidden");r.preventDefault();v(function(){if(n){return}a.addClass("disabled");a.parents("form").ajaxSubmit({headers:{"x-csrf-token":config.csrf_token},success:function(r){a.removeClass("disabled");if(!r){return}if(r.referrer){var s=utils.urlToLocation(r.referrer).pathname;var n=utils.params({url:r.referrer});n.registered=true;var i=decodeURIComponent($.param(n));window.location.href=s+"?"+i}else if(r.message){e.translate(r.message,function(e){bootbox.alert(e);ajaxify.go("/")})}},error:function(r){e.translate(r.responseText,config.defaultLang,function(e){if(r.status===403&&r.responseText==="Forbidden"){window.location.href=config.relative_path+"/register?error=csrf-invalid"}else{s.find("p").text(e);s.removeClass("hidden");a.removeClass("disabled")}})}})})});$("#email").focus()};function t(e,r){r=r||function(){};var a=$("#email-notify");if(!utils.isEmailValid(e)){u(a,"[[error:invalid-email]]");return r()}socket.emit("user.emailExists",{email:e},function(e,s){if(e){app.alertError(e.message);return r()}if(s){u(a,"[[error:email-taken]]")}else{m(a,i)}r()})}function o(e,r){r=r||function(){};var s=$("#username-notify");if(e.length<ajaxify.data.minimumUsernameLength){u(s,"[[error:username-too-short]]")}else if(e.length>ajaxify.data.maximumUsernameLength){u(s,"[[error:username-too-long]]")}else if(!utils.isUserNameValid(e)||!a(e)){u(s,"[[error:invalid-username]]")}else{socket.emit("user.exists",{username:e},function(e,a){if(e){return app.alertError(e.message)}if(a){u(s,"[[error:username-taken]]")}else{m(s,i)}r()})}}function l(e,a){var s=$("#password-notify");var n=$("#password-confirm-notify");var t=r(e);if(e.length<ajaxify.data.minimumPasswordLength){u(s,"[[reset_password:password_too_short]]")}else if(e.length>512){u(s,"[[error:password-too-long]]")}else if(!utils.isPasswordValid(e)){u(s,"[[user:change_password_error]]")}else if(e===$("#username").val()){u(s,"[[user:password_same_as_username]]")}else if(e===$("#email").val()){u(s,"[[user:password_same_as_email]]")}else if(t.score<ajaxify.data.minimumPasswordStrength){u(s,"[[user:weak_password]]")}else{m(s,i)}if(e!==a&&a!==""){u(n,"[[user:change_password_error_match]]")}}function f(e,r){var a=$("#password-notify");var s=$("#password-confirm-notify");if(!e||a.hasClass("alert-error")){return}if(e!==r){u(s,"[[user:change_password_error_match]]")}else{m(s,i)}}function u(r,a){e.translate(a,function(e){r.html(e);r.parent().removeClass("register-success").addClass("register-danger");r.show()});n=true}function m(r,a){e.translate(a,function(e){r.html(e);r.parent().removeClass("register-danger").addClass("register-success");r.show()})}function c(){if(!app.user.uid&&config.defaultLang!==config.userLang){var e=$('[component="register/local"]');var r=$('<input type="hidden" name="userLang" value="'+config.userLang+'" />');e.append(r)}}return s});
//# sourceMappingURL=register.js.map