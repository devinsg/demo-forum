"use strict";define("forum/flags/detail",["forum/flags/list","components","translator","benchpress","forum/account/header","accounts/delete"],function(t,e,a,r,i,s){var o={};o.init=function(){$("#state").val(ajaxify.data.state).removeAttr("disabled");$("#assignee").val(ajaxify.data.assignee).removeAttr("disabled");$("#content > div").on("click","[data-action]",function(){var t=this.getAttribute("data-action");var e=$(this).parents("[data-uid]").attr("data-uid");var a=document.getElementById("note");switch(t){case"assign":$("#assignee").val(app.user.uid);case"update":socket.emit("flags.update",{flagId:ajaxify.data.flagId,data:$("#attributes").serializeArray()},function(t,e){if(t){return app.alertError(t.message)}app.alertSuccess("[[flags:updated]]");o.reloadHistory(e)});break;case"appendNote":socket.emit("flags.appendNote",{flagId:ajaxify.data.flagId,note:a.value,datetime:a.getAttribute("data-datetime")},function(t,e){if(t){return app.alertError(t.message)}app.alertSuccess("[[flags:note-added]]");o.reloadNotes(e.notes);o.reloadHistory(e.history);a.setAttribute("data-action","appendNote");a.removeAttribute("data-datetime")});break;case"chat":app.newChat(e);break;case"ban":i.banAccount(e,ajaxify.refresh);break;case"delete-account":s.account(e,ajaxify.refresh);break;case"delete-content":s.content(e,ajaxify.refresh);break;case"delete-all":s.purge(e,ajaxify.refresh);break;case"delete-post":n("delete",ajaxify.data.target.pid,ajaxify.data.target.tid);break;case"purge-post":n("purge",ajaxify.data.target.pid,ajaxify.data.target.tid);break;case"restore-post":n("restore",ajaxify.data.target.pid,ajaxify.data.target.tid);break;case"delete-note":var r=this.closest("[data-datetime]").getAttribute("data-datetime");bootbox.confirm("[[flags:delete-note-confirm]]",function(t){if(t){socket.emit("flags.deleteNote",{flagId:ajaxify.data.flagId,datetime:r},function(t,e){if(t){return app.alertError(t.message)}app.alertSuccess("[[flags:note-deleted]]");o.reloadNotes(e.notes);o.reloadHistory(e.history)})}});break;case"prepare-edit":var d=this.closest("[data-index]");var f=d.getAttribute("data-index");var c=document.getElementById("note");c.value=ajaxify.data.notes[f].content;c.setAttribute("data-datetime",ajaxify.data.notes[f].datetime);var l=d.parentElement.children;for(var u in l){if(l.hasOwnProperty(u)){l[u].classList.remove("editing")}}d.classList.add("editing");c.focus();break}})};function n(t,e,r){a.translate("[[topic:post_"+t+"_confirm]]",function(a){bootbox.confirm(a,function(a){if(!a){return}socket.emit("posts."+t,{pid:e,tid:r},function(t){if(t){app.alertError(t.message)}ajaxify.refresh()})})})}o.reloadNotes=function(t){ajaxify.data.notes=t;r.parse("flags/detail","notes",{notes:t},function(t){var a=e.get("flag/notes");a.empty();a.html(t);a.find("span.timeago").timeago();document.getElementById("note").value=""})};o.reloadHistory=function(t){r.parse("flags/detail","history",{history:t},function(t){a.translate(t,function(t){var a=e.get("flag/history");a.empty();a.html(t);a.find("span.timeago").timeago()})})};return o});
//# sourceMappingURL=detail.js.map