{"version":3,"sources":["public/src/client/account/edit.js"],"names":["define","header","translator","pictureCropper","Benchpress","api","AccountEdit","init","$","on","updateProfile","app","loadJQueryUI","datepicker","changeMonth","changeYear","yearRange","defaultDate","handleImageChange","handleAccountDelete","handleEmailConfirm","updateSignature","updateAboutMe","handleGroupSort","userData","uid","val","fullname","website","birthday","location","groupTitle","signature","aboutme","JSON","stringify","Array","isArray","window","trigger","put","then","res","alertSuccess","picture","attr","updateHeader","parseInt","ajaxify","data","theirid","yourid","defaultAvatar","socket","emit","err","pictures","alertError","message","uploaded","reduce","memo","cur","type","parse","icon","text","bgColor","allowProfileImageUploads","html","translate","modal","bootbox","dialog","className","title","show","buttons","close","label","callback","onCloseModal","update","saveSelection","updateImages","selectImageType","find","removeClass","this","addClass","handleImageUpload","parents","each","getAttribute","changeUserPicture","refresh","translated","confirm","confirmBtn","prop","password","restoreButton","confirmText","href","config","relative_path","focus","onUploadComplete","urlOnServer","startsWith","Date","now","length","uploadedpicture","onRemoveComplete","socketMethod","route","userslug","aspectRatio","paramName","paramValue","fileSize","maximumProfileImageSize","allowSkippingCrop","description","accept","allowedProfileImageExtensios","url","uploadModal","handleImageCrop","btn","removeAttr","getCharsLeft","el","max","maximumSignatureLength","maximumAboutMeLength","move","direction","selected","allowMultipleBadges","insertAfter","next","prev","insertBefore"],"mappings":"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","file":"public/src/client/account/edit.js","sourcesContent":["'use strict';\n\ndefine('forum/account/edit', [\n\t'forum/account/header',\n\t'translator',\n\t'pictureCropper',\n\t'benchpress',\n\t'api',\n], function (header, translator, pictureCropper, Benchpress, api) {\n\tvar AccountEdit = {};\n\n\tAccountEdit.init = function () {\n\t\theader.init();\n\n\t\t$('#submitBtn').on('click', updateProfile);\n\n\t\tapp.loadJQueryUI(function () {\n\t\t\t$('#inputBirthday').datepicker({\n\t\t\t\tchangeMonth: true,\n\t\t\t\tchangeYear: true,\n\t\t\t\tyearRange: '1900:-5y',\n\t\t\t\tdefaultDate: '-13y',\n\t\t\t});\n\t\t});\n\n\t\thandleImageChange();\n\t\thandleAccountDelete();\n\t\thandleEmailConfirm();\n\t\tupdateSignature();\n\t\tupdateAboutMe();\n\t\thandleGroupSort();\n\t};\n\n\tfunction updateProfile() {\n\t\tvar userData = {\n\t\t\tuid: $('#inputUID').val(),\n\t\t\tfullname: $('#inputFullname').val(),\n\t\t\twebsite: $('#inputWebsite').val(),\n\t\t\tbirthday: $('#inputBirthday').val(),\n\t\t\tlocation: $('#inputLocation').val(),\n\t\t\tgroupTitle: $('#groupTitle').val(),\n\t\t\tsignature: $('#inputSignature').val(),\n\t\t\taboutme: $('#inputAboutMe').val(),\n\t\t};\n\n\t\tuserData.groupTitle = JSON.stringify(Array.isArray(userData.groupTitle) ? userData.groupTitle : [userData.groupTitle]);\n\n\t\t$(window).trigger('action:profile.update', userData);\n\n\t\tapi.put('/users/' + userData.uid, userData).then((res) => {\n\t\t\tapp.alertSuccess('[[user:profile-update-success]]');\n\n\t\t\tif (res.picture) {\n\t\t\t\t$('#user-current-picture').attr('src', res.picture);\n\t\t\t}\n\n\t\t\tupdateHeader(res.picture);\n\t\t});\n\n\t\treturn false;\n\t}\n\n\tfunction updateHeader(picture) {\n\t\tif (parseInt(ajaxify.data.theirid, 10) !== parseInt(ajaxify.data.yourid, 10)) {\n\t\t\treturn;\n\t\t}\n\t\tif (!picture && ajaxify.data.defaultAvatar) {\n\t\t\tpicture = ajaxify.data.defaultAvatar;\n\t\t}\n\t\t$('#header [component=\"avatar/picture\"]')[picture ? 'show' : 'hide']();\n\t\t$('#header [component=\"avatar/icon\"]')[!picture ? 'show' : 'hide']();\n\t\tif (picture) {\n\t\t\t$('#header [component=\"avatar/picture\"]').attr('src', picture);\n\t\t}\n\t}\n\n\tfunction handleImageChange() {\n\t\t$('#changePictureBtn').on('click', function () {\n\t\t\tsocket.emit('user.getProfilePictures', {\n\t\t\t\tuid: ajaxify.data.uid,\n\t\t\t}, function (err, pictures) {\n\t\t\t\tif (err) {\n\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t}\n\n\t\t\t\t// boolean to signify whether an uploaded picture is present in the pictures list\n\t\t\t\tvar uploaded = pictures.reduce(function (memo, cur) {\n\t\t\t\t\treturn memo || cur.type === 'uploaded';\n\t\t\t\t}, false);\n\n\t\t\t\tBenchpress.parse('partials/modals/change_picture_modal', {\n\t\t\t\t\tpictures: pictures,\n\t\t\t\t\tuploaded: uploaded,\n\t\t\t\t\ticon: { text: ajaxify.data['icon:text'], bgColor: ajaxify.data['icon:bgColor'] },\n\t\t\t\t\tdefaultAvatar: ajaxify.data.defaultAvatar,\n\t\t\t\t\tallowProfileImageUploads: ajaxify.data.allowProfileImageUploads,\n\t\t\t\t}, function (html) {\n\t\t\t\t\ttranslator.translate(html, function (html) {\n\t\t\t\t\t\tvar modal = bootbox.dialog({\n\t\t\t\t\t\t\tclassName: 'picture-switcher',\n\t\t\t\t\t\t\ttitle: '[[user:change_picture]]',\n\t\t\t\t\t\t\tmessage: html,\n\t\t\t\t\t\t\tshow: true,\n\t\t\t\t\t\t\tbuttons: {\n\t\t\t\t\t\t\t\tclose: {\n\t\t\t\t\t\t\t\t\tlabel: '[[global:close]]',\n\t\t\t\t\t\t\t\t\tcallback: onCloseModal,\n\t\t\t\t\t\t\t\t\tclassName: 'btn-link',\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tupdate: {\n\t\t\t\t\t\t\t\t\tlabel: '[[global:save_changes]]',\n\t\t\t\t\t\t\t\t\tcallback: saveSelection,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tmodal.on('shown.bs.modal', updateImages);\n\t\t\t\t\t\tmodal.on('click', '.list-group-item', function selectImageType() {\n\t\t\t\t\t\t\tmodal.find('.list-group-item').removeClass('active');\n\t\t\t\t\t\t\t$(this).addClass('active');\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\thandleImageUpload(modal);\n\n\t\t\t\t\t\tfunction updateImages() {\n\t\t\t\t\t\t\t// Check to see which one is the active picture\n\t\t\t\t\t\t\tif (!ajaxify.data.picture) {\n\t\t\t\t\t\t\t\tmodal.find('.list-group-item .user-icon').parents('.list-group-item').addClass('active');\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tmodal.find('.list-group-item img').each(function () {\n\t\t\t\t\t\t\t\t\tif (this.getAttribute('src') === ajaxify.data.picture) {\n\t\t\t\t\t\t\t\t\t\t$(this).parents('.list-group-item').addClass('active');\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tfunction saveSelection() {\n\t\t\t\t\t\t\tvar type = modal.find('.list-group-item.active').attr('data-type');\n\n\t\t\t\t\t\t\tchangeUserPicture(type, function (err) {\n\t\t\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tupdateHeader(type === 'default' ? '' : modal.find('.list-group-item.active img').attr('src'));\n\t\t\t\t\t\t\t\tajaxify.refresh();\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tfunction onCloseModal() {\n\t\t\t\t\t\t\tmodal.modal('hide');\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\n\t\t\treturn false;\n\t\t});\n\t}\n\n\tfunction handleAccountDelete() {\n\t\t$('#deleteAccountBtn').on('click', function () {\n\t\t\ttranslator.translate('[[user:delete_account_confirm]]', function (translated) {\n\t\t\t\tvar modal = bootbox.confirm(translated + '<p><input type=\"password\" class=\"form-control\" id=\"confirm-password\" /></p>', function (confirm) {\n\t\t\t\t\tif (!confirm) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar confirmBtn = modal.find('.btn-primary');\n\t\t\t\t\tconfirmBtn.html('<i class=\"fa fa-spinner fa-spin\"></i>');\n\t\t\t\t\tconfirmBtn.prop('disabled', true);\n\n\t\t\t\t\tsocket.emit('user.deleteAccount', {\n\t\t\t\t\t\tpassword: $('#confirm-password').val(),\n\t\t\t\t\t}, function (err) {\n\t\t\t\t\t\tfunction restoreButton() {\n\t\t\t\t\t\t\ttranslator.translate('[[modules:bootbox.confirm]]', function (confirmText) {\n\t\t\t\t\t\t\t\tconfirmBtn.text(confirmText);\n\t\t\t\t\t\t\t\tconfirmBtn.prop('disabled', false);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\trestoreButton();\n\t\t\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconfirmBtn.html('<i class=\"fa fa-check\"></i>');\n\t\t\t\t\t\twindow.location.href = config.relative_path + '/';\n\t\t\t\t\t});\n\n\t\t\t\t\treturn false;\n\t\t\t\t});\n\n\t\t\t\tmodal.on('shown.bs.modal', function () {\n\t\t\t\t\tmodal.find('input').focus();\n\t\t\t\t});\n\t\t\t});\n\t\t\treturn false;\n\t\t});\n\t}\n\n\tfunction handleImageUpload(modal) {\n\t\tfunction onUploadComplete(urlOnServer) {\n\t\t\turlOnServer = (!urlOnServer.startsWith('http') ? config.relative_path : '') + urlOnServer + '?' + Date.now();\n\n\t\t\tupdateHeader(urlOnServer);\n\n\t\t\tif (ajaxify.data.picture && ajaxify.data.picture.length) {\n\t\t\t\t$('#user-current-picture, img.avatar').attr('src', urlOnServer);\n\t\t\t\tajaxify.data.uploadedpicture = urlOnServer;\n\t\t\t} else {\n\t\t\t\tajaxify.refresh(function () {\n\t\t\t\t\t$('#user-current-picture, img.avatar').attr('src', urlOnServer);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tfunction onRemoveComplete() {\n\t\t\tif (ajaxify.data.uploadedpicture === ajaxify.data.picture) {\n\t\t\t\tajaxify.refresh();\n\t\t\t\tupdateHeader();\n\t\t\t}\n\t\t}\n\n\t\tmodal.find('[data-action=\"upload\"]').on('click', function () {\n\t\t\tmodal.modal('hide');\n\n\t\t\tpictureCropper.show({\n\t\t\t\tsocketMethod: 'user.uploadCroppedPicture',\n\t\t\t\troute: config.relative_path + '/api/user/' + ajaxify.data.userslug + '/uploadpicture',\n\t\t\t\taspectRatio: 1 / 1,\n\t\t\t\tparamName: 'uid',\n\t\t\t\tparamValue: ajaxify.data.theirid,\n\t\t\t\tfileSize: ajaxify.data.maximumProfileImageSize,\n\t\t\t\tallowSkippingCrop: false,\n\t\t\t\ttitle: '[[user:upload_picture]]',\n\t\t\t\tdescription: '[[user:upload_a_picture]]',\n\t\t\t\taccept: ajaxify.data.allowedProfileImageExtensios,\n\t\t\t}, function (url) {\n\t\t\t\tonUploadComplete(url);\n\t\t\t});\n\n\t\t\treturn false;\n\t\t});\n\n\t\tmodal.find('[data-action=\"upload-url\"]').on('click', function () {\n\t\t\tmodal.modal('hide');\n\t\t\tBenchpress.parse('partials/modals/upload_picture_from_url_modal', {}, function (html) {\n\t\t\t\ttranslator.translate(html, function (html) {\n\t\t\t\t\tvar uploadModal = $(html);\n\t\t\t\t\tuploadModal.modal('show');\n\n\t\t\t\t\tuploadModal.find('.upload-btn').on('click', function () {\n\t\t\t\t\t\tvar url = uploadModal.find('#uploadFromUrl').val();\n\t\t\t\t\t\tif (!url) {\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tuploadModal.modal('hide');\n\n\t\t\t\t\t\tpictureCropper.handleImageCrop({\n\t\t\t\t\t\t\turl: url,\n\t\t\t\t\t\t\tsocketMethod: 'user.uploadCroppedPicture',\n\t\t\t\t\t\t\taspectRatio: 1,\n\t\t\t\t\t\t\tallowSkippingCrop: false,\n\t\t\t\t\t\t\tparamName: 'uid',\n\t\t\t\t\t\t\tparamValue: ajaxify.data.theirid,\n\t\t\t\t\t\t}, onUploadComplete);\n\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\n\t\t\treturn false;\n\t\t});\n\n\t\tmodal.find('[data-action=\"remove-uploaded\"]').on('click', function () {\n\t\t\tsocket.emit('user.removeUploadedPicture', {\n\t\t\t\tuid: ajaxify.data.theirid,\n\t\t\t}, function (err) {\n\t\t\t\tmodal.modal('hide');\n\t\t\t\tif (err) {\n\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t}\n\t\t\t\tonRemoveComplete();\n\t\t\t});\n\t\t});\n\t}\n\n\tfunction handleEmailConfirm() {\n\t\t$('#confirm-email').on('click', function () {\n\t\t\tvar btn = $(this).attr('disabled', true);\n\t\t\tsocket.emit('user.emailConfirm', {}, function (err) {\n\t\t\t\tbtn.removeAttr('disabled');\n\t\t\t\tif (err) {\n\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t}\n\t\t\t\tapp.alertSuccess('[[notifications:email-confirm-sent]]');\n\t\t\t});\n\t\t});\n\t}\n\n\tfunction changeUserPicture(type, callback) {\n\t\tsocket.emit('user.changePicture', {\n\t\t\ttype: type,\n\t\t\tuid: ajaxify.data.theirid,\n\t\t}, callback);\n\t}\n\n\tfunction getCharsLeft(el, max) {\n\t\treturn el.length ? '(' + el.val().length + '/' + max + ')' : '';\n\t}\n\n\tfunction updateSignature() {\n\t\tvar el = $('#inputSignature');\n\t\t$('#signatureCharCountLeft').html(getCharsLeft(el, ajaxify.data.maximumSignatureLength));\n\n\t\tel.on('keyup change', function () {\n\t\t\t$('#signatureCharCountLeft').html(getCharsLeft(el, ajaxify.data.maximumSignatureLength));\n\t\t});\n\t}\n\n\tfunction updateAboutMe() {\n\t\tvar el = $('#inputAboutMe');\n\t\t$('#aboutMeCharCountLeft').html(getCharsLeft(el, ajaxify.data.maximumAboutMeLength));\n\n\t\tel.on('keyup change', function () {\n\t\t\t$('#aboutMeCharCountLeft').html(getCharsLeft(el, ajaxify.data.maximumAboutMeLength));\n\t\t});\n\t}\n\n\tfunction handleGroupSort() {\n\t\tfunction move(direction) {\n\t\t\tvar selected = $('#groupTitle').val();\n\t\t\tif (!ajaxify.data.allowMultipleBadges || (Array.isArray(selected) && selected.length > 1)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar el = $('#groupTitle').find(':selected');\n\t\t\tif (el.length && el.val()) {\n\t\t\t\tif (direction > 0) {\n\t\t\t\t\tel.insertAfter(el.next());\n\t\t\t\t} else if (el.prev().val()) {\n\t\t\t\t\tel.insertBefore(el.prev());\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t$('[component=\"group/order/up\"]').on('click', function () {\n\t\t\tmove(-1);\n\t\t});\n\t\t$('[component=\"group/order/down\"]').on('click', function () {\n\t\t\tmove(1);\n\t\t});\n\t}\n\n\treturn AccountEdit;\n});\n"]}