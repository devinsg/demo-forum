{"version":3,"sources":["public/src/client/post-queue.js"],"names":["define","categoryFilter","categorySelector","PostQueue","init","$","tooltip","on","parent","this","parents","action","attr","id","listContainer","get","parentNode","some","valid","socket","emit","err","app","alertError","message","remove","childElementCount","ajaxify","refresh","handleContentEdit","$this","modal","data","allCategories","cid","category","find","c","parseInt","parseAndTranslate","posts","html","replaceWith","addClass","displayClass","editableClass","inputSelector","el","inputEl","length","removeClass","focus","textarea","preview","titleEdit","title","val","undefined","content","postData"],"mappings":"AAAA,aAGAA,OAAO,oBACN,iBAAkB,oBAChB,SAAUC,EAAgBC,GAC5B,IAAIC,KAEJA,EAAUC,KAAO,WAChBC,EAAE,2BAA2BC,UAE7BL,EAAeG,KAAKC,EAAE,oCAEtBA,EAAE,eAAeE,GAAG,QAAS,gBAAiB,WAC7C,IAAIC,EAASH,EAAEI,MAAMC,QAAQ,aAC7B,IAAIC,EAASN,EAAEI,MAAMG,KAAK,eAC1B,IAAIC,EAAKL,EAAOI,KAAK,WACrB,IAAIE,EAAgBN,EAAOO,IAAI,GAAGC,WAElC,KAAM,SAAU,UAAUC,KAAK,SAAUC,GACxC,OAAOP,IAAWO,IACf,CACH,OAGDC,OAAOC,KAAK,SAAWT,GAAUE,GAAIA,GAAM,SAAUQ,GACpD,GAAIA,EAAK,CACR,OAAOC,IAAIC,WAAWF,EAAIG,SAE3BhB,EAAOiB,SAEP,GAAIX,EAAcY,oBAAsB,EAAG,CAC1CC,QAAQC,aAGV,OAAO,QAGRC,EAAkB,gBAAiB,yBAA0B,YAC7DA,EAAkB,eAAgB,wBAAyB,SAE3DxB,EAAE,eAAeE,GAAG,QAAS,iCAAkC,WAC9D,IAAIuB,EAAQzB,EAAEI,MACd,IAAII,EAAKiB,EAAMpB,QAAQ,aAAaE,KAAK,WACzCV,EAAiB6B,MAAMJ,QAAQK,KAAKC,cAAe,SAAUC,GAC5D,IAAIC,EAAWR,QAAQK,KAAKC,cAAcG,KAAK,SAAUC,GACxD,OAAOC,SAASD,EAAEH,IAAK,MAAQI,SAASJ,EAAK,MAE9Cf,OAAOC,KAAK,2BACXP,GAAIA,EACJqB,IAAKA,GACH,SAAUb,GACZ,GAAIA,EAAK,CACR,OAAOC,IAAIC,WAAWF,EAAIG,SAE3BF,IAAIiB,kBAAkB,aAAc,SACnCC,QACCL,SAAUA,KAET,SAAUM,GACZX,EAAMY,YAAYD,EAAKL,KAAK,0BAI/B,OAAO,QAGR/B,EAAE,uDAAuDsC,SAAS,mBAGnE,SAASd,EAAkBe,EAAcC,EAAeC,GACvDzC,EAAE,eAAeE,GAAG,QAASqC,EAAc,WAC1C,IAAIG,EAAK1C,EAAEI,MACX,IAAIuC,EAAUD,EAAGvC,SAAS4B,KAAKS,GAC/B,GAAIG,EAAQC,OAAQ,CACnBF,EAAGJ,SAAS,UACZK,EAAQE,YAAY,UAAUd,KAAKU,GAAeK,WAIpD9C,EAAE,eAAeE,GAAG,OAAQsC,EAAgB,IAAMC,EAAe,WAChE,IAAIM,EAAW/C,EAAEI,MACjB,IAAI4C,EAAUD,EAAS5C,SAASA,SAAS4B,KAAKQ,GAC9C,IAAI/B,EAAKuC,EAAS1C,QAAQ,aAAaE,KAAK,WAC5C,IAAI0C,EAAYV,IAAiB,eAEjCzB,OAAOC,KAAK,2BACXP,GAAIA,EACJ0C,MAAOD,EAAYF,EAASI,MAAQC,UACpCC,QAASJ,EAAYG,UAAYL,EAASI,OACxC,SAAUnC,EAAKW,GACjB,GAAIX,EAAK,CACR,OAAOC,IAAIC,WAAWF,GAEvBgC,EAAQZ,KAAKa,EAAYtB,EAAK2B,SAASJ,MAAQvB,EAAK2B,SAASD,SAC7DN,EAAS5C,SAASmC,SAAS,UAC3BU,EAAQH,YAAY,cAKvB,OAAO/C","file":"public/src/client/post-queue.js","sourcesContent":["'use strict';\n\n\ndefine('forum/post-queue', [\n\t'categoryFilter', 'categorySelector',\n], function (categoryFilter, categorySelector) {\n\tvar PostQueue = {};\n\n\tPostQueue.init = function () {\n\t\t$('[data-toggle=\"tooltip\"]').tooltip();\n\n\t\tcategoryFilter.init($('[component=\"category/dropdown\"]'));\n\n\t\t$('.posts-list').on('click', '[data-action]', function () {\n\t\t\tvar parent = $(this).parents('[data-id]');\n\t\t\tvar action = $(this).attr('data-action');\n\t\t\tvar id = parent.attr('data-id');\n\t\t\tvar listContainer = parent.get(0).parentNode;\n\n\t\t\tif (!['accept', 'reject'].some(function (valid) {\n\t\t\t\treturn action === valid;\n\t\t\t})) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tsocket.emit('posts.' + action, { id: id }, function (err) {\n\t\t\t\tif (err) {\n\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t}\n\t\t\t\tparent.remove();\n\n\t\t\t\tif (listContainer.childElementCount === 0) {\n\t\t\t\t\tajaxify.refresh();\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn false;\n\t\t});\n\n\t\thandleContentEdit('.post-content', '.post-content-editable', 'textarea');\n\t\thandleContentEdit('.topic-title', '.topic-title-editable', 'input');\n\n\t\t$('.posts-list').on('click', '.topic-category[data-editable]', function () {\n\t\t\tvar $this = $(this);\n\t\t\tvar id = $this.parents('[data-id]').attr('data-id');\n\t\t\tcategorySelector.modal(ajaxify.data.allCategories, function (cid) {\n\t\t\t\tvar category = ajaxify.data.allCategories.find(function (c) {\n\t\t\t\t\treturn parseInt(c.cid, 10) === parseInt(cid, 10);\n\t\t\t\t});\n\t\t\t\tsocket.emit('posts.editQueuedContent', {\n\t\t\t\t\tid: id,\n\t\t\t\t\tcid: cid,\n\t\t\t\t}, function (err) {\n\t\t\t\t\tif (err) {\n\t\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t\t}\n\t\t\t\t\tapp.parseAndTranslate('post-queue', 'posts', {\n\t\t\t\t\t\tposts: [{\n\t\t\t\t\t\t\tcategory: category,\n\t\t\t\t\t\t}],\n\t\t\t\t\t}, function (html) {\n\t\t\t\t\t\t$this.replaceWith(html.find('.topic-category'));\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t\treturn false;\n\t\t});\n\n\t\t$('[component=\"post/content\"] img:not(.not-responsive)').addClass('img-responsive');\n\t};\n\n\tfunction handleContentEdit(displayClass, editableClass, inputSelector) {\n\t\t$('.posts-list').on('click', displayClass, function () {\n\t\t\tvar el = $(this);\n\t\t\tvar inputEl = el.parent().find(editableClass);\n\t\t\tif (inputEl.length) {\n\t\t\t\tel.addClass('hidden');\n\t\t\t\tinputEl.removeClass('hidden').find(inputSelector).focus();\n\t\t\t}\n\t\t});\n\n\t\t$('.posts-list').on('blur', editableClass + ' ' + inputSelector, function () {\n\t\t\tvar textarea = $(this);\n\t\t\tvar preview = textarea.parent().parent().find(displayClass);\n\t\t\tvar id = textarea.parents('[data-id]').attr('data-id');\n\t\t\tvar titleEdit = displayClass === '.topic-title';\n\n\t\t\tsocket.emit('posts.editQueuedContent', {\n\t\t\t\tid: id,\n\t\t\t\ttitle: titleEdit ? textarea.val() : undefined,\n\t\t\t\tcontent: titleEdit ? undefined : textarea.val(),\n\t\t\t}, function (err, data) {\n\t\t\t\tif (err) {\n\t\t\t\t\treturn app.alertError(err);\n\t\t\t\t}\n\t\t\t\tpreview.html(titleEdit ? data.postData.title : data.postData.content);\n\t\t\t\ttextarea.parent().addClass('hidden');\n\t\t\t\tpreview.removeClass('hidden');\n\t\t\t});\n\t\t});\n\t}\n\n\treturn PostQueue;\n});\n"]}