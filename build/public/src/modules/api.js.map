{"version":3,"sources":["public/src/modules/api.js"],"names":["define","api","baseUrl","config","relative_path","call","options","callback","url","startsWith","doAjax","cb","$","ajax","done","res","hasOwnProperty","response","fail","ev","errMessage","responseJSON","status","message","error","Error","statusText","utils","hasLanguageKey","app","alertError","Promise","resolve","reject","err","data","get","route","payload","onSuccess","Object","keys","length","param","post","method","headers","x-csrf-token","csrf_token","put","del"],"mappings":"AAAA,aAEAA,OAAO,MAAO,KACb,MAAMC,KACN,MAAMC,EAAUC,OAAOC,cAAgB,UAEvC,SAASC,EAAKC,EAASC,GACtBD,EAAQE,IAAMF,EAAQE,IAAIC,WAAW,QACpCN,OAAOC,cAAgBE,EAAQE,IAC/BN,EAAUI,EAAQE,IAEnB,SAASE,EAAOC,GACfC,EAAEC,KAAKP,GACLQ,KAAMC,IACNJ,EAAG,KACFI,EAAIC,eAAe,WAAaD,EAAIC,eAAe,YAClDD,EAAIE,SAAWF,KAGjBG,KAAMC,IACN,MAAMC,EAAaD,EAAGE,aAAaC,QAAUH,EAAGE,aAAaC,OAAOC,QACnEJ,EAAGE,aAAaC,OAAOC,QACvBJ,EAAGE,aAAaG,MAEjB,MAAMA,EAAQ,IAAIC,MAAML,GAAcD,EAAGO,YAEzC,IAAKC,MAAMC,eAAeJ,EAAMD,SAAU,CACzCM,IAAIC,WAAWN,EAAMD,SAGtBZ,EAAGa,KAIN,UAAWjB,IAAa,WAAY,CACnCG,EAAOH,GACP,OAGD,OAAO,IAAIwB,QAAQ,CAACC,EAASC,KAC5BvB,EAAO,SAAUwB,EAAKC,GACrB,GAAID,EAAKD,EAAOC,QACXF,EAAQG,OAKhBlC,EAAImC,IAAM,EAACC,EAAOC,EAASC,IAAclC,GACxCG,IAAK6B,GAASG,OAAOC,KAAKH,GAASI,OAAU,IAAM9B,EAAE+B,MAAML,GAAY,KACrEC,IAEHtC,EAAI2C,KAAO,EAACP,EAAOC,EAASC,IAAclC,GACzCG,IAAK6B,EACLQ,OAAQ,OACRV,KAAMG,EACNQ,SACCC,eAAgB5C,OAAO6C,aAEtBT,IAEHtC,EAAIgD,IAAM,EAACZ,EAAOC,EAASC,IAAclC,GACxCG,IAAK6B,EACLQ,OAAQ,MACRV,KAAMG,EACNQ,SACCC,eAAgB5C,OAAO6C,aAEtBT,IAEHtC,EAAIiD,IAAM,EAACb,EAAOC,EAASC,IAAclC,GACxCG,IAAK6B,EACLQ,OAAQ,SACRV,KAAMG,EACNQ,SACCC,eAAgB5C,OAAO6C,aAEtBT,IAEH,OAAOtC","file":"public/src/modules/api.js","sourcesContent":["'use strict';\n\ndefine('api', () => {\n\tconst api = {};\n\tconst baseUrl = config.relative_path + '/api/v3';\n\n\tfunction call(options, callback) {\n\t\toptions.url = options.url.startsWith('/api') ?\n\t\t\tconfig.relative_path + options.url :\n\t\t\tbaseUrl + options.url;\n\n\t\tfunction doAjax(cb) {\n\t\t\t$.ajax(options)\n\t\t\t\t.done((res) => {\n\t\t\t\t\tcb(null,\n\t\t\t\t\t\tres.hasOwnProperty('status') && res.hasOwnProperty('response') ?\n\t\t\t\t\t\t\tres.response : res\n\t\t\t\t\t);\n\t\t\t\t})\n\t\t\t\t.fail((ev) => {\n\t\t\t\t\tconst errMessage = ev.responseJSON.status && ev.responseJSON.status.message ?\n\t\t\t\t\t\tev.responseJSON.status.message :\n\t\t\t\t\t\tev.responseJSON.error;\n\n\t\t\t\t\tconst error = new Error(errMessage || ev.statusText);\n\n\t\t\t\t\tif (!utils.hasLanguageKey(error.message)) {\n\t\t\t\t\t\tapp.alertError(error.message);\n\t\t\t\t\t}\n\n\t\t\t\t\tcb(error);\n\t\t\t\t});\n\t\t}\n\n\t\tif (typeof callback === 'function') {\n\t\t\tdoAjax(callback);\n\t\t\treturn;\n\t\t}\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tdoAjax(function (err, data) {\n\t\t\t\tif (err) reject(err);\n\t\t\t\telse resolve(data);\n\t\t\t});\n\t\t});\n\t}\n\n\tapi.get = (route, payload, onSuccess) => call({\n\t\turl: route + (Object.keys(payload).length ? ('?' + $.param(payload)) : ''),\n\t}, onSuccess);\n\n\tapi.post = (route, payload, onSuccess) => call({\n\t\turl: route,\n\t\tmethod: 'post',\n\t\tdata: payload,\n\t\theaders: {\n\t\t\t'x-csrf-token': config.csrf_token,\n\t\t},\n\t}, onSuccess);\n\n\tapi.put = (route, payload, onSuccess) => call({\n\t\turl: route,\n\t\tmethod: 'put',\n\t\tdata: payload,\n\t\theaders: {\n\t\t\t'x-csrf-token': config.csrf_token,\n\t\t},\n\t}, onSuccess);\n\n\tapi.del = (route, payload, onSuccess) => call({\n\t\turl: route,\n\t\tmethod: 'delete',\n\t\tdata: payload,\n\t\theaders: {\n\t\t\t'x-csrf-token': config.csrf_token,\n\t\t},\n\t}, onSuccess);\n\n\treturn api;\n});\n"]}