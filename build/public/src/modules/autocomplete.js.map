{"version":3,"sources":["public/src/modules/autocomplete.js"],"names":["define","module","user","input","params","onselect","app","loadJQueryUI","autocomplete","delay","open","$","this","css","select","event","ui","handleOnSelect","source","request","response","query","term","socket","emit","err","result","alertError","message","users","names","map","username","html","text","label","value","uid","name","slug","userslug","picture","icon:text","icon:bgColor","attr","group","results","length","tag","cid","ajaxify","data","tags","e","jQuery","Event","which","keyCode","setTimeout","trigger"],"mappings":"AACA,aAGAA,OAAO,eAAgB,WACtB,IAAIC,KAEJA,EAAOC,KAAO,SAAUC,EAAOC,EAAQC,GACtC,UAAWD,IAAW,WAAY,CACjCC,EAAWD,EACXA,KAGDE,IAAIC,aAAa,WAChBJ,EAAMK,cACLC,MAAO,IACPC,KAAM,WACLC,EAAEC,MAAMJ,aAAa,UAAUK,IAAI,UAAW,SAE/CC,OAAQ,SAAUC,EAAOC,GACxBC,EAAed,EAAOE,EAAUU,EAAOC,IAExCE,OAAQ,SAAUC,EAASC,GAC1BhB,EAAOiB,MAAQF,EAAQG,KAEvBC,OAAOC,KAAK,cAAepB,EAAQ,SAAUqB,EAAKC,GACjD,GAAID,EAAK,CACR,OAAOnB,IAAIqB,WAAWF,EAAIG,SAG3B,GAAIF,GAAUA,EAAOG,MAAO,CAC3B,IAAIC,EAAQJ,EAAOG,MAAME,IAAI,SAAU7B,GACtC,IAAI8B,EAAWrB,EAAE,eAAesB,KAAK/B,EAAK8B,UAAUE,OACpD,OAAOhC,IACNiC,MAAOH,EACPI,MAAOJ,EACP9B,MACCmC,IAAKnC,EAAKmC,IACVC,KAAMpC,EAAK8B,SACXO,KAAMrC,EAAKsC,SACXR,SAAU9B,EAAK8B,SACfQ,SAAUtC,EAAKsC,SACfC,QAASvC,EAAKuC,QACdC,YAAaxC,EAAK,aAClByC,eAAgBzC,EAAK,oBAIxBkB,EAASU,GAGVnB,EAAE,sBAAsBiC,KAAK,eAAgB,iBAOlD3C,EAAO4C,MAAQ,SAAU1C,EAAOE,GAC/BC,IAAIC,aAAa,WAChBJ,EAAMK,cACLC,MAAO,IACPC,KAAM,WACLC,EAAEC,MAAMJ,aAAa,UAAUK,IAAI,UAAW,SAE/CC,OAAQ,SAAUC,EAAOC,GACxBC,EAAed,EAAOE,EAAUU,EAAOC,IAExCE,OAAQ,SAAUC,EAASC,GAC1BG,OAAOC,KAAK,iBACXH,MAAOF,EAAQG,MACb,SAAUG,EAAKqB,GACjB,GAAIrB,EAAK,CACR,OAAOnB,IAAIqB,WAAWF,EAAIG,SAE3B,GAAIkB,GAAWA,EAAQC,OAAQ,CAC9B,IAAIjB,EAAQgB,EAAQf,IAAI,SAAUc,GACjC,OAAOA,IACNV,MAAOU,EAAMP,KACbF,MAAOS,EAAMP,KACbO,MAAOA,KAGTzB,EAASU,GAEVnB,EAAE,sBAAsBiC,KAAK,eAAgB,iBAOlD3C,EAAO+C,IAAM,SAAU7C,EAAOE,GAC7BC,IAAIC,aAAa,WAChBJ,EAAMK,cACLC,MAAO,IACPC,KAAM,WACLC,EAAEC,MAAMJ,aAAa,UAAUK,IAAI,UAAW,MAE/CC,OAAQ,SAAUC,EAAOC,GACxBC,EAAed,EAAOE,EAAUU,EAAOC,IAExCE,OAAQ,SAAUC,EAASC,GAC1BG,OAAOC,KAAK,2BACXH,MAAOF,EAAQG,KACf2B,IAAKC,QAAQC,KAAKF,KAAO,GACvB,SAAUxB,EAAK2B,GACjB,GAAI3B,EAAK,CACR,OAAOnB,IAAIqB,WAAWF,EAAIG,SAE3B,GAAIwB,EAAM,CACThC,EAASgC,GAEVzC,EAAE,sBAAsBiC,KAAK,eAAgB,iBAOlD,SAAS3B,EAAed,EAAOE,EAAUU,EAAOC,GAC/CX,EAAWA,GAAY,aACvB,IAAIgD,EAAIC,OAAOC,MAAM,YACrBF,EAAEG,MAAQ,GACVH,EAAEI,QAAU,GACZC,WAAW,WACVvD,EAAMwD,QAAQN,IACZ,KACHhD,EAASU,EAAOC,GAGjB,OAAOf","file":"public/src/modules/autocomplete.js","sourcesContent":["\n'use strict';\n\n\ndefine('autocomplete', function () {\n\tvar module = {};\n\n\tmodule.user = function (input, params, onselect) {\n\t\tif (typeof params === 'function') {\n\t\t\tonselect = params;\n\t\t\tparams = {};\n\t\t}\n\n\t\tapp.loadJQueryUI(function () {\n\t\t\tinput.autocomplete({\n\t\t\t\tdelay: 200,\n\t\t\t\topen: function () {\n\t\t\t\t\t$(this).autocomplete('widget').css('z-index', 100005);\n\t\t\t\t},\n\t\t\t\tselect: function (event, ui) {\n\t\t\t\t\thandleOnSelect(input, onselect, event, ui);\n\t\t\t\t},\n\t\t\t\tsource: function (request, response) {\n\t\t\t\t\tparams.query = request.term;\n\n\t\t\t\t\tsocket.emit('user.search', params, function (err, result) {\n\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (result && result.users) {\n\t\t\t\t\t\t\tvar names = result.users.map(function (user) {\n\t\t\t\t\t\t\t\tvar username = $('<div></div>').html(user.username).text();\n\t\t\t\t\t\t\t\treturn user && {\n\t\t\t\t\t\t\t\t\tlabel: username,\n\t\t\t\t\t\t\t\t\tvalue: username,\n\t\t\t\t\t\t\t\t\tuser: {\n\t\t\t\t\t\t\t\t\t\tuid: user.uid,\n\t\t\t\t\t\t\t\t\t\tname: user.username,\n\t\t\t\t\t\t\t\t\t\tslug: user.userslug,\n\t\t\t\t\t\t\t\t\t\tusername: user.username,\n\t\t\t\t\t\t\t\t\t\tuserslug: user.userslug,\n\t\t\t\t\t\t\t\t\t\tpicture: user.picture,\n\t\t\t\t\t\t\t\t\t\t'icon:text': user['icon:text'],\n\t\t\t\t\t\t\t\t\t\t'icon:bgColor': user['icon:bgColor'],\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tresponse(names);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t$('.ui-autocomplete a').attr('data-ajaxify', 'false');\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t};\n\n\tmodule.group = function (input, onselect) {\n\t\tapp.loadJQueryUI(function () {\n\t\t\tinput.autocomplete({\n\t\t\t\tdelay: 200,\n\t\t\t\topen: function () {\n\t\t\t\t\t$(this).autocomplete('widget').css('z-index', 100005);\n\t\t\t\t},\n\t\t\t\tselect: function (event, ui) {\n\t\t\t\t\thandleOnSelect(input, onselect, event, ui);\n\t\t\t\t},\n\t\t\t\tsource: function (request, response) {\n\t\t\t\t\tsocket.emit('groups.search', {\n\t\t\t\t\t\tquery: request.term,\n\t\t\t\t\t}, function (err, results) {\n\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (results && results.length) {\n\t\t\t\t\t\t\tvar names = results.map(function (group) {\n\t\t\t\t\t\t\t\treturn group && {\n\t\t\t\t\t\t\t\t\tlabel: group.name,\n\t\t\t\t\t\t\t\t\tvalue: group.name,\n\t\t\t\t\t\t\t\t\tgroup: group,\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tresponse(names);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t$('.ui-autocomplete a').attr('data-ajaxify', 'false');\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t};\n\n\tmodule.tag = function (input, onselect) {\n\t\tapp.loadJQueryUI(function () {\n\t\t\tinput.autocomplete({\n\t\t\t\tdelay: 100,\n\t\t\t\topen: function () {\n\t\t\t\t\t$(this).autocomplete('widget').css('z-index', 20000);\n\t\t\t\t},\n\t\t\t\tselect: function (event, ui) {\n\t\t\t\t\thandleOnSelect(input, onselect, event, ui);\n\t\t\t\t},\n\t\t\t\tsource: function (request, response) {\n\t\t\t\t\tsocket.emit('topics.autocompleteTags', {\n\t\t\t\t\t\tquery: request.term,\n\t\t\t\t\t\tcid: ajaxify.data.cid || 0,\n\t\t\t\t\t}, function (err, tags) {\n\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (tags) {\n\t\t\t\t\t\t\tresponse(tags);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t$('.ui-autocomplete a').attr('data-ajaxify', 'false');\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t};\n\n\tfunction handleOnSelect(input, onselect, event, ui) {\n\t\tonselect = onselect || function () { };\n\t\tvar e = jQuery.Event('keypress');\n\t\te.which = 13;\n\t\te.keyCode = 13;\n\t\tsetTimeout(function () {\n\t\t\tinput.trigger(e);\n\t\t}, 100);\n\t\tonselect(event, ui);\n\t}\n\n\treturn module;\n});\n"]}