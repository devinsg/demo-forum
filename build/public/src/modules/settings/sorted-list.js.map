{"version":3,"sources":["public/src/modules/settings/sorted-list.js"],"names":["define","benchpress","SortedList","Settings","types","use","this","set","$container","values","key","attr","find","each","idx","item","itemUUID","$","formData","push","helper","serializeForm","get","$list","formTpl","parse","formHtml","addBtn","on","modal","bootbox","confirm","save","utils","generateUUID","form","append","children","hide","data","list","ajaxify","settings","Array","isArray","forEach","deserialize","sortable","addClass","window","trigger","element","setupRemoveButton","removeBtn","console","log","remove","setupEditButton","itemTpl","editBtn","clone","show","app","parseAndTranslate","itemHtml","oldItem","after"],"mappings":"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","file":"public/src/modules/settings/sorted-list.js","sourcesContent":["'use strict';\n\ndefine('settings/sorted-list', [\n\t'benchpress',\n\t'jquery-ui/widgets/sortable',\n], function (benchpress) {\n\tvar SortedList;\n\tvar Settings;\n\n\n\tSortedList = {\n\t\ttypes: ['sorted-list'],\n\t\tuse: function () {\n\t\t\tSettings = this;\n\t\t},\n\t\tset: function ($container, values) {\n\t\t\tvar key = $container.attr('data-sorted-list');\n\n\t\t\tvalues[key] = [];\n\t\t\t$container.find('[data-type=\"item\"]').each(function (idx, item) {\n\t\t\t\tvar itemUUID = $(item).attr('data-sorted-list-uuid');\n\n\t\t\t\tvar formData = $('[data-sorted-list-object=\"' + key + '\"][data-sorted-list-uuid=\"' + itemUUID + '\"]');\n\t\t\t\tvalues[key].push(Settings.helper.serializeForm(formData));\n\t\t\t});\n\t\t},\n\t\tget: function ($container) {\n\t\t\tvar $list = $container.find('[data-type=\"list\"]');\n\t\t\tvar key = $container.attr('data-sorted-list');\n\t\t\tvar formTpl = $container.attr('data-form-template');\n\n\t\t\tbenchpress.parse(formTpl, {}, function (formHtml) {\n\t\t\t\tvar addBtn = $('[data-sorted-list=\"' + key + '\"] [data-type=\"add\"]');\n\n\t\t\t\taddBtn.on('click', function () {\n\t\t\t\t\tvar modal = bootbox.confirm(formHtml, function (save) {\n\t\t\t\t\t\tif (save) {\n\t\t\t\t\t\t\tvar itemUUID = utils.generateUUID();\n\t\t\t\t\t\t\tvar form = $('<form class=\"\" data-sorted-list-uuid=\"' + itemUUID + '\" data-sorted-list-object=\"' + key + '\"></form>');\n\t\t\t\t\t\t\tform.append(modal.find('form').children());\n\n\t\t\t\t\t\t\t$('#content').append(form.hide());\n\n\n\t\t\t\t\t\t\tvar data = Settings.helper.serializeForm(form);\n\t\t\t\t\t\t\tparse($container, itemUUID, data);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\t\tvar list = ajaxify.data.settings[key];\n\t\t\t\tif (Array.isArray(list) && typeof list[0] !== 'string') {\n\t\t\t\t\tlist.forEach(function (item) {\n\t\t\t\t\t\tvar itemUUID = utils.generateUUID();\n\t\t\t\t\t\tvar form = $(formHtml).deserialize(item);\n\t\t\t\t\t\tform.attr('data-sorted-list-uuid', itemUUID);\n\t\t\t\t\t\tform.attr('data-sorted-list-object', key);\n\t\t\t\t\t\t$('#content').append(form.hide());\n\n\t\t\t\t\t\tparse($container, itemUUID, item);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t$list.sortable().addClass('pointer');\n\t\t\t$(window).trigger('action:settings.sorted-list.loaded', { element: $list.get(0) });\n\t\t},\n\t};\n\n\tfunction setupRemoveButton($container, itemUUID) {\n\t\tvar removeBtn = $container.find('[data-sorted-list-uuid=\"' + itemUUID + '\"] [data-type=\"remove\"]');\n\t\tremoveBtn.on('click', function () {\n\t\t\tconsole.log(itemUUID);\n\t\t\t$('[data-sorted-list-uuid=\"' + itemUUID + '\"]').remove();\n\t\t});\n\t}\n\n\tfunction setupEditButton($container, itemUUID) {\n\t\tvar $list = $container.find('[data-type=\"list\"]');\n\t\tvar key = $container.attr('data-sorted-list');\n\t\tvar itemTpl = $container.attr('data-item-template');\n\t\tvar editBtn = $('[data-sorted-list-uuid=\"' + itemUUID + '\"] [data-type=\"edit\"]');\n\n\t\teditBtn.on('click', function () {\n\t\t\tvar form = $('[data-sorted-list-uuid=\"' + itemUUID + '\"][data-sorted-list-object=\"' + key + '\"]').clone(true).show();\n\n\t\t\tvar modal = bootbox.confirm(form, function (save) {\n\t\t\t\tif (save) {\n\t\t\t\t\tvar form = $('<form class=\"\" data-sorted-list-uuid=\"' + itemUUID + '\" data-sorted-list-object=\"' + key + '\"></form>');\n\t\t\t\t\tform.append(modal.find('form').children());\n\n\t\t\t\t\t$('#content').find('[data-sorted-list-uuid=\"' + itemUUID + '\"][data-sorted-list-object=\"' + key + '\"]').remove();\n\t\t\t\t\t$('#content').append(form.hide());\n\n\n\t\t\t\t\tvar data = Settings.helper.serializeForm(form);\n\n\t\t\t\t\tapp.parseAndTranslate(itemTpl, data, function (itemHtml) {\n\t\t\t\t\t\titemHtml = $(itemHtml);\n\t\t\t\t\t\tvar oldItem = $list.find('[data-sorted-list-uuid=\"' + itemUUID + '\"]');\n\t\t\t\t\t\toldItem.after(itemHtml);\n\t\t\t\t\t\toldItem.remove();\n\t\t\t\t\t\titemHtml.attr('data-sorted-list-uuid', itemUUID);\n\n\t\t\t\t\t\tsetupRemoveButton($container, itemUUID);\n\t\t\t\t\t\tsetupEditButton($container, itemUUID);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\tfunction parse($container, itemUUID, data) {\n\t\tvar $list = $container.find('[data-type=\"list\"]');\n\t\tvar itemTpl = $container.attr('data-item-template');\n\n\t\tapp.parseAndTranslate(itemTpl, data, function (itemHtml) {\n\t\t\titemHtml = $(itemHtml);\n\t\t\t$list.append(itemHtml);\n\t\t\titemHtml.attr('data-sorted-list-uuid', itemUUID);\n\n\t\t\tsetupRemoveButton($container, itemUUID);\n\t\t\tsetupEditButton($container, itemUUID);\n\t\t});\n\t}\n\n\treturn SortedList;\n});\n"]}