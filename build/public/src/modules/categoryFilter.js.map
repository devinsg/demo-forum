{"version":3,"sources":["public/src/modules/categoryFilter.js"],"names":["define","categorySearch","categoryFilter","init","el","listEl","find","on","cids","getSelectedCids","changed","ajaxify","data","selectedCids","length","forEach","cid","index","url","window","location","pathname","currentParams","utils","params","decodeURIComponent","$","param","go","ev","selectChildren","parentCid","flag","toggleClass","each","attr","categoryEl","this","link","ctrlKey","hasClass","first","push","parseInt","sort","a","b"],"mappings":"AAAA,aAEAA,OAAO,kBAAmB,kBAAmB,SAAUC,GACtD,IAAIC,KAEJA,EAAeC,KAAO,SAAUC,GAC/BH,EAAeE,KAAKC,GACpB,IAAIC,EAASD,EAAGE,KAAK,+BAErBF,EAAGG,GAAG,qBAAsB,WAC3B,IAAIC,EAAOC,EAAgBL,GAC3B,IAAIM,EAAUC,QAAQC,KAAKC,aAAaC,SAAWN,EAAKM,OACxDH,QAAQC,KAAKC,aAAaE,QAAQ,SAAUC,EAAKC,GAChD,GAAID,IAAQR,EAAKS,GAAQ,CACxBP,EAAU,QAIZ,GAAIA,EAAS,CACZ,IAAIQ,EAAMC,OAAOC,SAASC,SAC1B,IAAIC,EAAgBC,MAAMC,SAC1B,GAAIhB,EAAKM,OAAQ,CAChBQ,EAAcN,IAAMR,EACpBU,GAAO,IAAMO,mBAAmBC,EAAEC,MAAML,IAEzCX,QAAQiB,GAAGV,MAIbb,EAAOE,GAAG,QAAS,aAAc,SAAUsB,GAC1C,SAASC,EAAeC,EAAWC,GAClC3B,EAAOC,KAAK,qBAAuByB,EAAY,yCAAyCE,YAAY,YAAaD,GACjH3B,EAAOC,KAAK,qBAAuByB,EAAY,MAAMG,KAAK,SAAUjB,EAAOb,GAC1E0B,EAAeJ,EAAEtB,GAAI+B,KAAK,YAAaH,KAGzC,IAAII,EAAaV,EAAEW,MACnB,IAAIC,EAAOF,EAAW9B,KAAK,KAAK6B,KAAK,QACrC,GAAIG,GAAQA,IAAS,KAAOA,EAAKxB,OAAQ,CACxC,OAED,IAAIE,EAAMoB,EAAWD,KAAK,YAC1B,GAAIN,EAAGU,QAAS,CACfT,EAAed,GAAMoB,EAAW9B,KAAK,sCAAsCkC,SAAS,cAErFJ,EAAW9B,KAAK,sCAAsC2B,YAAY,aAClE5B,EAAOC,KAAK,MAAMmC,QAAQnC,KAAK,KAAK2B,YAAY,cAAexB,EAAgBL,GAAIU,QACnF,OAAO,SAIT,SAASL,EAAgBL,GACxB,IAAII,KACJJ,EAAGE,KAAK,0CAA0C4B,KAAK,SAAUjB,EAAOb,GACvE,IAAKsB,EAAEtB,GAAIE,KAAK,sCAAsCkC,SAAS,aAAc,CAC5EhC,EAAKkC,KAAKC,SAASjB,EAAEtB,GAAI+B,KAAK,YAAa,QAG7C3B,EAAKoC,KAAK,SAAUC,EAAGC,GACtB,OAAOD,EAAIC,IAEZ,OAAOtC,EAGR,OAAON","file":"public/src/modules/categoryFilter.js","sourcesContent":["'use strict';\n\ndefine('categoryFilter', ['categorySearch'], function (categorySearch) {\n\tvar categoryFilter = {};\n\n\tcategoryFilter.init = function (el) {\n\t\tcategorySearch.init(el);\n\t\tvar listEl = el.find('[component=\"category/list\"]');\n\n\t\tel.on('hidden.bs.dropdown', function () {\n\t\t\tvar cids = getSelectedCids(el);\n\t\t\tvar changed = ajaxify.data.selectedCids.length !== cids.length;\n\t\t\tajaxify.data.selectedCids.forEach(function (cid, index) {\n\t\t\t\tif (cid !== cids[index]) {\n\t\t\t\t\tchanged = true;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (changed) {\n\t\t\t\tvar url = window.location.pathname;\n\t\t\t\tvar currentParams = utils.params();\n\t\t\t\tif (cids.length) {\n\t\t\t\t\tcurrentParams.cid = cids;\n\t\t\t\t\turl += '?' + decodeURIComponent($.param(currentParams));\n\t\t\t\t}\n\t\t\t\tajaxify.go(url);\n\t\t\t}\n\t\t});\n\n\t\tlistEl.on('click', '[data-cid]', function (ev) {\n\t\t\tfunction selectChildren(parentCid, flag) {\n\t\t\t\tlistEl.find('[data-parent-cid=\"' + parentCid + '\"] [component=\"category/select/icon\"]').toggleClass('invisible', flag);\n\t\t\t\tlistEl.find('[data-parent-cid=\"' + parentCid + '\"]').each(function (index, el) {\n\t\t\t\t\tselectChildren($(el).attr('data-cid'), flag);\n\t\t\t\t});\n\t\t\t}\n\t\t\tvar categoryEl = $(this);\n\t\t\tvar link = categoryEl.find('a').attr('href');\n\t\t\tif (link && link !== '#' && link.length) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar cid = categoryEl.attr('data-cid');\n\t\t\tif (ev.ctrlKey) {\n\t\t\t\tselectChildren(cid, !categoryEl.find('[component=\"category/select/icon\"]').hasClass('invisible'));\n\t\t\t}\n\t\t\tcategoryEl.find('[component=\"category/select/icon\"]').toggleClass('invisible');\n\t\t\tlistEl.find('li').first().find('i').toggleClass('invisible', !!getSelectedCids(el).length);\n\t\t\treturn false;\n\t\t});\n\t};\n\n\tfunction getSelectedCids(el) {\n\t\tvar cids = [];\n\t\tel.find('[component=\"category/list\"] [data-cid]').each(function (index, el) {\n\t\t\tif (!$(el).find('[component=\"category/select/icon\"]').hasClass('invisible')) {\n\t\t\t\tcids.push(parseInt($(el).attr('data-cid'), 10));\n\t\t\t}\n\t\t});\n\t\tcids.sort(function (a, b) {\n\t\t\treturn a - b;\n\t\t});\n\t\treturn cids;\n\t}\n\n\treturn categoryFilter;\n});\n"]}